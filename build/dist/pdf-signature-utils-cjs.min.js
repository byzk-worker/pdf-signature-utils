"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("spark-md5")),n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var i={},o={},s={},a={},c={},u={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.SocketDataError=e.FieldType=void 0,(t=e.FieldType||(e.FieldType={}))[t.STRING=1]="STRING",t[t.INTEGER=2]="INTEGER",t[t.DOUBLE=3]="DOUBLE",t[t.BOOL=4]="BOOL",t[t.LIST=5]="LIST",t[t.STRUCT=6]="STRUCT",t[t.VOID=7]="VOID",t[t.ERROR=8]="ERROR";class n extends Error{constructor(e){super(e),this.name="数据序列化错误"}}e.SocketDataError=n}(u);var l={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.requireFn=e.getLineContentByFile=e.getFieldTypeByFieldTypeStr=e.getLineContent=e.getListEleFieldType=e.joinLineStr=e.getFieldType=e.ObjectKeys=e.newLine=void 0;const t=u;function n(e){if(e instanceof Array)return t.FieldType.LIST;switch(typeof e){case"boolean":return t.FieldType.BOOL;case"string":return t.FieldType.STRING;case"object":return t.FieldType.STRUCT;case"number":return(e+"").includes(".")?t.FieldType.DOUBLE:t.FieldType.INTEGER;default:throw new t.SocketDataError("获取数据类型失败")}}e.newLine="\n",e.ObjectKeys=function(e){let t=[];for(let n in e)t.push(n);return t},e.getFieldType=n,e.joinLineStr=function(t){return t+e.newLine},e.getListEleFieldType=function(e){if(0==e.length)return undefined;const r=n(e[0]);for(let i=1;i<e.length;i++)if(n(e[i])!==r)throw new t.SocketDataError("数组内元素必须保持一致");return r},e.getLineContent=function(t){const n=t[0],r=n.indexOf(e.newLine);if(r<0)return"";const i=n.substring(0,r);return t[0]=n.substring(r+1),i},e.getFieldTypeByFieldTypeStr=function(e){const n=parseInt(e);if(n<t.FieldType.STRING||n>t.FieldType.ERROR)throw new t.SocketDataError("获取字段类型失败");return n},e.getLineContentByFile=function(t,n,r){const i=r.alloc(1);let o="";for(;;){if(0==t.readSync(n,i,0,1,null))return"";const r=i.toString("utf-8");if(r===e.newLine)return o;o+=r}},e.requireFn=r||window&&window.require}(l);var d,f,h,p,m,y,g={},v={exports:{}},C={};function w(){if(h)return f;h=1;var e=(d||(d=1,n.crypto&&n.crypto.getRandomValues?C.randomBytes=function(e){var t=new Uint8Array(e);return n.crypto.getRandomValues(t),t}:C.randomBytes=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=Math.floor(256*Math.random());return t}),C),t="abcdefghijklmnopqrstuvwxyz012345";return f={string:function(n){for(var r=t.length,i=e.randomBytes(n),o=[],s=0;s<n;s++)o.push(t.substr(i[s]%r,1));return o.join("")},number:function(e){return Math.floor(Math.random()*e)},numberString:function(e){var t=(""+(e-1)).length;return(new Array(t+1).join("0")+this.number(e)).slice(-t)}}}function S(){return p||(p=1,function(e){var t=w(),r={},i=!1,o=n.chrome&&n.chrome.app&&n.chrome.app.runtime;e.exports={attachEvent:function(e,t){"undefined"!=typeof n.addEventListener?n.addEventListener(e,t,!1):n.document&&n.attachEvent&&(n.document.attachEvent("on"+e,t),n.attachEvent("on"+e,t))},detachEvent:function(e,t){"undefined"!=typeof n.addEventListener?n.removeEventListener(e,t,!1):n.document&&n.detachEvent&&(n.document.detachEvent("on"+e,t),n.detachEvent("on"+e,t))},unloadAdd:function(e){if(o)return null;var n=t.string(8);return r[n]=e,i&&setTimeout(this.triggerUnloadCallbacks,0),n},unloadDel:function(e){e in r&&delete r[e]},triggerUnloadCallbacks:function(){for(var e in r)r[e](),delete r[e]}};o||e.exports.attachEvent("unload",(function(){i||(i=!0,e.exports.triggerUnloadCallbacks())}))}(v)),v.exports}var b,_,E,T={};function F(){if(E)return _;E=1;var e=y?m:(y=1,m=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}),t=function(){if(b)return T;b=1;var e=Object.prototype.hasOwnProperty;function t(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return null}}function n(e){try{return encodeURIComponent(e)}catch(t){return null}}return T.stringify=function(t,r){r=r||"";var i,o,s=[];for(o in"string"!=typeof r&&(r="?"),t)if(e.call(t,o)){if((i=t[o])||null!=i&&!isNaN(i)||(i=""),o=n(o),i=n(i),null===o||null===i)continue;s.push(o+"="+i)}return s.length?r+s.join("&"):""},T.parse=function(e){for(var n,r=/([^=?#&]+)=?([^&]*)/g,i={};n=r.exec(e);){var o=t(n[1]),s=t(n[2]);null===o||null===s||o in i||(i[o]=s)}return i},T}(),r=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,i=/[\n\r\t]/g,o=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,s=/:\d+$/,a=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,c=/^[a-zA-Z]:/;function u(e){return(e||"").toString().replace(r,"")}var l=[["#","hash"],["?","query"],function(e,t){return h(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",undefined,1,1],[/:(\d*)$/,"port",undefined,1],[NaN,"hostname",undefined,1,1]],d={hash:1,query:1};function f(e){var t,r=("undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:{}).location||{},i={},s=typeof(e=e||r);if("blob:"===e.protocol)i=new g(unescape(e.pathname),{});else if("string"===s)for(t in i=new g(e,{}),d)delete i[t];else if("object"===s){for(t in e)t in d||(i[t]=e[t]);i.slashes===undefined&&(i.slashes=o.test(e.href))}return i}function h(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function p(e,t){e=(e=u(e)).replace(i,""),t=t||{};var n,r=a.exec(e),o=r[1]?r[1].toLowerCase():"",s=!!r[2],c=!!r[3],l=0;return s?c?(n=r[2]+r[3]+r[4],l=r[2].length+r[3].length):(n=r[2]+r[4],l=r[2].length):c?(n=r[3]+r[4],l=r[3].length):n=r[4],"file:"===o?l>=2&&(n=n.slice(2)):h(o)?n=r[4]:o?s&&(n=n.slice(2)):l>=2&&h(t.protocol)&&(n=r[4]),{protocol:o,slashes:s||h(o),slashesCount:l,rest:n}}function g(n,r,o){if(n=(n=u(n)).replace(i,""),!(this instanceof g))return new g(n,r,o);var s,a,d,m,y,v,C=l.slice(),w=typeof r,S=this,b=0;for("object"!==w&&"string"!==w&&(o=r,r=null),o&&"function"!=typeof o&&(o=t.parse),s=!(a=p(n||"",r=f(r))).protocol&&!a.slashes,S.slashes=a.slashes||s&&r.slashes,S.protocol=a.protocol||r.protocol||"",n=a.rest,("file:"===a.protocol&&(2!==a.slashesCount||c.test(n))||!a.slashes&&(a.protocol||a.slashesCount<2||!h(S.protocol)))&&(C[3]=[/(.*)/,"pathname"]);b<C.length;b++)"function"!=typeof(m=C[b])?(d=m[0],v=m[1],d!=d?S[v]=n:"string"==typeof d?~(y="@"===d?n.lastIndexOf(d):n.indexOf(d))&&("number"==typeof m[2]?(S[v]=n.slice(0,y),n=n.slice(y+m[2])):(S[v]=n.slice(y),n=n.slice(0,y))):(y=d.exec(n))&&(S[v]=y[1],n=n.slice(0,y.index)),S[v]=S[v]||s&&m[3]&&r[v]||"",m[4]&&(S[v]=S[v].toLowerCase())):n=m(n,S);o&&(S.query=o(S.query)),s&&r.slashes&&"/"!==S.pathname.charAt(0)&&(""!==S.pathname||""!==r.pathname)&&(S.pathname=function(e,t){if(""===e)return t;for(var n=(t||"/").split("/").slice(0,-1).concat(e.split("/")),r=n.length,i=n[r-1],o=!1,s=0;r--;)"."===n[r]?n.splice(r,1):".."===n[r]?(n.splice(r,1),s++):s&&(0===r&&(o=!0),n.splice(r,1),s--);return o&&n.unshift(""),"."!==i&&".."!==i||n.push(""),n.join("/")}(S.pathname,r.pathname)),"/"!==S.pathname.charAt(0)&&h(S.protocol)&&(S.pathname="/"+S.pathname),e(S.port,S.protocol)||(S.host=S.hostname,S.port=""),S.username=S.password="",S.auth&&(~(y=S.auth.indexOf(":"))?(S.username=S.auth.slice(0,y),S.username=encodeURIComponent(decodeURIComponent(S.username)),S.password=S.auth.slice(y+1),S.password=encodeURIComponent(decodeURIComponent(S.password))):S.username=encodeURIComponent(decodeURIComponent(S.auth)),S.auth=S.password?S.username+":"+S.password:S.username),S.origin="file:"!==S.protocol&&h(S.protocol)&&S.host?S.protocol+"//"+S.host:"null",S.href=S.toString()}return g.prototype={set:function(n,r,i){var o=this;switch(n){case"query":"string"==typeof r&&r.length&&(r=(i||t.parse)(r)),o[n]=r;break;case"port":o[n]=r,e(r,o.protocol)?r&&(o.host=o.hostname+":"+r):(o.host=o.hostname,o[n]="");break;case"hostname":o[n]=r,o.port&&(r+=":"+o.port),o.host=r;break;case"host":o[n]=r,s.test(r)?(r=r.split(":"),o.port=r.pop(),o.hostname=r.join(":")):(o.hostname=r,o.port="");break;case"protocol":o.protocol=r.toLowerCase(),o.slashes=!i;break;case"pathname":case"hash":if(r){var a="pathname"===n?"/":"#";o[n]=r.charAt(0)!==a?a+r:r}else o[n]=r;break;case"username":case"password":o[n]=encodeURIComponent(r);break;case"auth":var c=r.indexOf(":");~c?(o.username=r.slice(0,c),o.username=encodeURIComponent(decodeURIComponent(o.username)),o.password=r.slice(c+1),o.password=encodeURIComponent(decodeURIComponent(o.password))):o.username=encodeURIComponent(decodeURIComponent(r))}for(var u=0;u<l.length;u++){var d=l[u];d[4]&&(o[d[1]]=o[d[1]].toLowerCase())}return o.auth=o.password?o.username+":"+o.password:o.username,o.origin="file:"!==o.protocol&&h(o.protocol)&&o.host?o.protocol+"//"+o.host:"null",o.href=o.toString(),o},toString:function(e){e&&"function"==typeof e||(e=t.stringify);var n,r=this,i=r.host,o=r.protocol;o&&":"!==o.charAt(o.length-1)&&(o+=":");var a=o+(r.protocol&&r.slashes||h(r.protocol)?"//":"");return r.username?(a+=r.username,r.password&&(a+=":"+r.password),a+="@"):r.password?(a+=":"+r.password,a+="@"):"file:"!==r.protocol&&h(r.protocol)&&!i&&"/"!==r.pathname&&(a+="@"),(":"===i[i.length-1]||s.test(r.hostname)&&!r.port)&&(i+=":"),a+=i+r.pathname,(n="object"==typeof r.query?e(r.query):r.query)&&(a+="?"!==n.charAt(0)?"?"+n:n),r.hash&&(a+=r.hash),a}},g.extractProtocol=p,g.location=f,g.trimLeft=u,g.qs=t,_=g}var x,k,I,O,N,j,M,R={exports:{}};function L(){if(k)return x;k=1;var e=1e3,t=60*e,n=60*t,r=24*n,i=7*r,o=365.25*r;function s(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}return x=function(a,c){c=c||{};var u=typeof a;if("string"===u&&a.length>0)return function(s){if((s=String(s)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(s);if(!a)return;var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*i;case"days":case"day":case"d":return c*r;case"hours":case"hour":case"hrs":case"hr":case"h":return c*n;case"minutes":case"minute":case"mins":case"min":case"m":return c*t;case"seconds":case"second":case"secs":case"sec":case"s":return c*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return undefined}}(a);if("number"===u&&isFinite(a))return c.long?function(i){var o=Math.abs(i);if(o>=r)return s(i,o,r,"day");if(o>=n)return s(i,o,n,"hour");if(o>=t)return s(i,o,t,"minute");if(o>=e)return s(i,o,e,"second");return i+" ms"}(a):function(i){var o=Math.abs(i);if(o>=r)return Math.round(i/r)+"d";if(o>=n)return Math.round(i/n)+"h";if(o>=t)return Math.round(i/t)+"m";if(o>=e)return Math.round(i/e)+"s";return i+"ms"}(a);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))}}function P(){return N||(N=1,function(e,t){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}t.log=function(){var e;return"object"===("undefined"==typeof console?"undefined":n(console))&&console.log&&(e=console).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(n){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(n){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=(O||(O=1,I=function(e){function t(e){for(var t=0,r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){var o;function s(){if(s.enabled){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=s,a=Number(new Date),c=a-(o||a);i.diff=c,i.prev=o,i.curr=a,o=a,t[0]=n.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var u=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,r){if("%%"===e)return e;u++;var o=n.formatters[r];if("function"==typeof o){var s=t[u];e=o.call(i,s),t.splice(u,1),u--}return e})),n.formatArgs.call(i,t),(i.log||n.log).apply(i,t)}}return s.namespace=e,s.enabled=n.enabled(e),s.useColors=n.useColors(),s.color=t(e),s.destroy=r,s.extend=i,"function"==typeof n.init&&n.init(s),n.instances.push(s),s}function r(){var e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function i(e,t){return n(this.namespace+(void 0===t?":":t)+e)}return n.debug=n,n["default"]=n,n.coerce=function(e){return e instanceof Error?e.stack||e.message:e},n.disable=function(){n.enable("")},n.enable=function(e){var t;n.save(e),n.names=[],n.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(t=0;t<i;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")));for(t=0;t<n.instances.length;t++){var o=n.instances[t];o.enabled=n.enabled(o.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;var t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=L(),Object.keys(e).forEach((function(t){n[t]=e[t]})),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=t,n.enable(n.load()),n}),I)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}(R,R.exports)),R.exports}function A(){if(M)return j;M=1;var e=F(),t=function(){};return"production"!==process.env.NODE_ENV&&(t=P()("sockjs-client:utils:url")),j={getOrigin:function(t){if(!t)return null;var n=new e(t);if("file:"===n.protocol)return null;var r=n.port;return r||(r="https:"===n.protocol?"443":"80"),n.protocol+"//"+n.hostname+":"+r},isOriginEqual:function(e,n){var r=this.getOrigin(e)===this.getOrigin(n);return t("same",e,n,r),r},isSchemeEqual:function(e,t){return e.split(":")[0]===t.split(":")[0]},addPath:function(e,t){var n=e.split("?");return n[0]+t+(n[1]?"?"+n[1]:"")},addQuery:function(e,t){return e+(-1===e.indexOf("?")?"?"+t:"&"+t)},isLoopbackAddr:function(e){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^\[::1\]$/.test(e)}}}var D,B={exports:{}};function q(){return D||(D=1,"function"==typeof Object.create?B.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:B.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}),B.exports}var U,K,W,V={};function G(){if(K)return U;function e(){this._listeners={}}return K=1,e.prototype.addEventListener=function(e,t){e in this._listeners||(this._listeners[e]=[]);var n=this._listeners[e];-1===n.indexOf(t)&&(n=n.concat([t])),this._listeners[e]=n},e.prototype.removeEventListener=function(e,t){var n=this._listeners[e];if(n){var r=n.indexOf(t);-1===r||(n.length>1?this._listeners[e]=n.slice(0,r).concat(n.slice(r+1)):delete this._listeners[e])}},e.prototype.dispatchEvent=function(){var e=arguments[0],t=e.type,n=1===arguments.length?[e]:Array.apply(null,arguments);if(this["on"+t]&&this["on"+t].apply(this,n),t in this._listeners)for(var r=this._listeners[t],i=0;i<r.length;i++)r[i].apply(this,n)},U=e}function z(){if(W)return V;W=1;var e=q(),t=G();function n(){t.call(this)}return e(n,t),n.prototype.removeAllListeners=function(e){e?delete this._listeners[e]:this._listeners={}},n.prototype.once=function(e,t){var n=this,r=!1;this.on(e,(function i(){n.removeListener(e,i),r||(r=!0,t.apply(this,arguments))}))},n.prototype.emit=function(){var e=arguments[0],t=this._listeners[e];if(t){for(var n=arguments.length,r=new Array(n-1),i=1;i<n;i++)r[i-1]=arguments[i];for(var o=0;o<t.length;o++)t[o].apply(this,r)}},n.prototype.on=n.prototype.addListener=t.prototype.addEventListener,n.prototype.removeListener=t.prototype.removeEventListener,V.EventEmitter=n,V}var H,J,X,$,Y,Q,Z,ee,te,ne,re,ie,oe,se,ae,ce,ue,le,de,fe,he,pe,me,ye,ge,ve,Ce,we,Se,be,_e,Ee,Te,Fe,xe,ke={exports:{}};function Ie(){if(X)return J;X=1;var e=S(),t=A(),r=q(),i=z().EventEmitter,o=function(){if(H)return ke.exports;H=1;var e=n.WebSocket||n.MozWebSocket;return ke.exports=e?function(t){return new e(t)}:undefined,ke.exports}(),s=function(){};function a(n,r,c){if(!a.enabled())throw new Error("Transport created when disabled");i.call(this),s("constructor",n);var u=this,l=t.addPath(n,"/websocket");l="https"===l.slice(0,5)?"wss"+l.slice(5):"ws"+l.slice(4),this.url=l,this.ws=new o(this.url,[],c),this.ws.onmessage=function(e){s("message event",e.data),u.emit("message",e.data)},this.unloadRef=e.unloadAdd((function(){s("unload"),u.ws.close()})),this.ws.onclose=function(e){s("close event",e.code,e.reason),u.emit("close",e.code,e.reason),u._cleanup()},this.ws.onerror=function(e){s("error event",e),u.emit("close",1006,"WebSocket connection broken"),u._cleanup()}}return"production"!==process.env.NODE_ENV&&(s=P()("sockjs-client:websocket")),r(a,i),a.prototype.send=function(e){var t="["+e+"]";s("send",t),this.ws.send(t)},a.prototype.close=function(){s("close");var e=this.ws;this._cleanup(),e&&e.close()},a.prototype._cleanup=function(){s("_cleanup");var t=this.ws;t&&(t.onmessage=t.onclose=t.onerror=null),e.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},a.enabled=function(){return s("enabled"),!!o},a.transportName="websocket",a.roundTrips=2,J=a}function Oe(){if(te)return ee;te=1;var e=q(),t=A(),n=function(){if(Y)return $;Y=1;var e=q(),t=z().EventEmitter,n=function(){};function r(e,r){n(e),t.call(this),this.sendBuffer=[],this.sender=r,this.url=e}return"production"!==process.env.NODE_ENV&&(n=P()("sockjs-client:buffered-sender")),e(r,t),r.prototype.send=function(e){n("send",e),this.sendBuffer.push(e),this.sendStop||this.sendSchedule()},r.prototype.sendScheduleWait=function(){n("sendScheduleWait");var e,t=this;this.sendStop=function(){n("sendStop"),t.sendStop=null,clearTimeout(e)},e=setTimeout((function(){n("timeout"),t.sendStop=null,t.sendSchedule()}),25)},r.prototype.sendSchedule=function(){n("sendSchedule",this.sendBuffer.length);var e=this;if(this.sendBuffer.length>0){var t="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,t,(function(t){e.sendStop=null,t?(n("error",t),e.emit("close",t.code||1006,"Sending error: "+t),e.close()):e.sendScheduleWait()})),this.sendBuffer=[]}},r.prototype._cleanup=function(){n("_cleanup"),this.removeAllListeners()},r.prototype.close=function(){n("close"),this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},$=r}(),r=function(){if(Z)return Q;Z=1;var e=q(),t=z().EventEmitter,n=function(){};function r(e,r,i){n(r),t.call(this),this.Receiver=e,this.receiveUrl=r,this.AjaxObject=i,this._scheduleReceiver()}return"production"!==process.env.NODE_ENV&&(n=P()("sockjs-client:polling")),e(r,t),r.prototype._scheduleReceiver=function(){n("_scheduleReceiver");var e=this,t=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);t.on("message",(function(t){n("message",t),e.emit("message",t)})),t.once("close",(function(r,i){n("close",r,i,e.pollIsClosing),e.poll=t=null,e.pollIsClosing||("network"===i?e._scheduleReceiver():(e.emit("close",r||1006,i),e.removeAllListeners()))}))},r.prototype.abort=function(){n("abort"),this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},Q=r}(),i=function(){};function o(e,o,s,a,c){var u=t.addPath(e,o);i(u);var l=this;n.call(this,e,s),this.poll=new r(a,u,c),this.poll.on("message",(function(e){i("poll message",e),l.emit("message",e)})),this.poll.once("close",(function(e,t){i("poll close",e,t),l.poll=null,l.emit("close",e,t),l.close()}))}return"production"!==process.env.NODE_ENV&&(i=P()("sockjs-client:sender-receiver")),e(o,n),o.prototype.close=function(){n.prototype.close.call(this),i("close"),this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null)},ee=o}function Ne(){if(re)return ne;re=1;var e=q(),t=A(),n=Oe(),r=function(){};function i(e,i,o,s){n.call(this,e,i,function(e){return function(n,i,o){r("create ajax sender",n,i);var s={};"string"==typeof i&&(s.headers={"Content-type":"text/plain"});var a=t.addPath(n,"/xhr_send"),c=new e("POST",a,i,s);return c.once("finish",(function(e){if(r("finish",e),c=null,200!==e&&204!==e)return o(new Error("http status "+e));o()})),function(){r("abort"),c.close(),c=null;var e=new Error("Aborted");e.code=1e3,o(e)}}}(s),o,s)}return"production"!==process.env.NODE_ENV&&(r=P()("sockjs-client:ajax-based")),e(i,n),ne=i}function je(){if(oe)return ie;oe=1;var e=q(),t=z().EventEmitter,n=function(){};function r(e,r){n(e),t.call(this);var i=this;this.bufferPosition=0,this.xo=new r("POST",e,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",(function(e,t){n("finish",e,t),i._chunkHandler(e,t),i.xo=null;var r=200===e?"network":"permanent";n("close",r),i.emit("close",null,r),i._cleanup()}))}return"production"!==process.env.NODE_ENV&&(n=P()("sockjs-client:receiver:xhr")),e(r,t),r.prototype._chunkHandler=function(e,t){if(n("_chunkHandler",e),200===e&&t)for(var r=-1;;this.bufferPosition+=r+1){var i=t.slice(this.bufferPosition);if(-1===(r=i.indexOf("\n")))break;var o=i.slice(0,r);o&&(n("message",o),this.emit("message",o))}},r.prototype._cleanup=function(){n("_cleanup"),this.removeAllListeners()},r.prototype.abort=function(){n("abort"),this.xo&&(this.xo.close(),n("close"),this.emit("close",null,"user"),this.xo=null),this._cleanup()},ie=r}function Me(){if(ae)return se;ae=1;var e=z().EventEmitter,t=q(),r=S(),i=A(),o=n.XMLHttpRequest,s=function(){};function a(t,n,r,i){s(t,n);var o=this;e.call(this),setTimeout((function(){o._start(t,n,r,i)}),0)}"production"!==process.env.NODE_ENV&&(s=P()("sockjs-client:browser:xhr")),t(a,e),a.prototype._start=function(e,t,n,c){var u=this;try{this.xhr=new o}catch(d){}if(!this.xhr)return s("no xhr"),this.emit("finish",0,"no xhr support"),void this._cleanup();t=i.addQuery(t,"t="+ +new Date),this.unloadRef=r.unloadAdd((function(){s("unload cleanup"),u._cleanup(!0)}));try{this.xhr.open(e,t,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){s("xhr timeout"),u.emit("finish",0,""),u._cleanup(!1)})}catch(f){return s("exception",f),this.emit("finish",0,""),void this._cleanup(!1)}if(c&&c.noCredentials||!a.supportsCORS||(s("withCredentials"),this.xhr.withCredentials=!0),c&&c.headers)for(var l in c.headers)this.xhr.setRequestHeader(l,c.headers[l]);this.xhr.onreadystatechange=function(){if(u.xhr){var e,t,n=u.xhr;switch(s("readyState",n.readyState),n.readyState){case 3:try{t=n.status,e=n.responseText}catch(f){}s("status",t),1223===t&&(t=204),200===t&&e&&e.length>0&&(s("chunk"),u.emit("chunk",t,e));break;case 4:t=n.status,s("status",t),1223===t&&(t=204),12005!==t&&12029!==t||(t=0),s("finish",t,n.responseText),u.emit("finish",t,n.responseText),u._cleanup(!1)}}};try{u.xhr.send(n)}catch(f){u.emit("finish",0,""),u._cleanup(!1)}},a.prototype._cleanup=function(e){if(s("cleanup"),this.xhr){if(this.removeAllListeners(),r.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),e)try{this.xhr.abort()}catch(t){}this.unloadRef=this.xhr=null}},a.prototype.close=function(){s("close"),this._cleanup(!0)},a.enabled=!!o;var c=["Active"].concat("Object").join("X");!a.enabled&&c in n&&(s("overriding xmlhttprequest"),o=function(){try{return new n[c]("Microsoft.XMLHTTP")}catch(e){return null}},a.enabled=!!new o);var u=!1;try{u="withCredentials"in new o}catch(l){}return a.supportsCORS=u,se=a}function Re(){if(ue)return ce;ue=1;var e=q(),t=Me();function n(e,n,r,i){t.call(this,e,n,r,i)}return e(n,t),n.enabled=t.enabled&&t.supportsCORS,ce=n}function Le(){if(de)return le;de=1;var e=q(),t=Me();function n(e,n,r){t.call(this,e,n,r,{noCredentials:!0})}return e(n,t),n.enabled=t.enabled,le=n}function Pe(){return he?fe:(he=1,fe={isOpera:function(){return n.navigator&&/opera/i.test(n.navigator.userAgent)},isKonqueror:function(){return n.navigator&&/konqueror/i.test(n.navigator.userAgent)},hasDomain:function(){if(!n.document)return!0;try{return!!n.document.domain}catch(e){return!1}}})}function Ae(){if(me)return pe;me=1;var e=q(),t=Ne(),r=je(),i=Re(),o=Le(),s=Pe();function a(e){if(!o.enabled&&!i.enabled)throw new Error("Transport created when disabled");t.call(this,e,"/xhr_streaming",r,i)}return e(a,t),a.enabled=function(e){return!e.nullOrigin&&(!s.isOpera()&&i.enabled)},a.transportName="xhr-streaming",a.roundTrips=2,a.needBody=!!n.document,pe=a}function De(){if(ge)return ye;ge=1;var e=z().EventEmitter,t=q(),r=S(),i=Pe(),o=A(),s=function(){};function a(t,n,r){s(t,n);var i=this;e.call(this),setTimeout((function(){i._start(t,n,r)}),0)}return"production"!==process.env.NODE_ENV&&(s=P()("sockjs-client:sender:xdr")),t(a,e),a.prototype._start=function(e,t,i){s("_start");var a=this,c=new n.XDomainRequest;t=o.addQuery(t,"t="+ +new Date),c.onerror=function(){s("onerror"),a._error()},c.ontimeout=function(){s("ontimeout"),a._error()},c.onprogress=function(){s("progress",c.responseText),a.emit("chunk",200,c.responseText)},c.onload=function(){s("load"),a.emit("finish",200,c.responseText),a._cleanup(!1)},this.xdr=c,this.unloadRef=r.unloadAdd((function(){a._cleanup(!0)}));try{this.xdr.open(e,t),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(i)}catch(u){this._error()}},a.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},a.prototype._cleanup=function(e){if(s("cleanup",e),this.xdr){if(this.removeAllListeners(),r.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,e)try{this.xdr.abort()}catch(t){}this.unloadRef=this.xdr=null}},a.prototype.close=function(){s("close"),this._cleanup(!0)},a.enabled=!(!n.XDomainRequest||!i.hasDomain()),ye=a}function Be(){if(Ce)return ve;Ce=1;var e=q(),t=Ne(),n=je(),r=De();function i(e){if(!r.enabled)throw new Error("Transport created when disabled");t.call(this,e,"/xhr_streaming",n,r)}return e(i,t),i.enabled=function(e){return!e.cookie_needed&&!e.nullOrigin&&(r.enabled&&e.sameScheme)},i.transportName="xdr-streaming",i.roundTrips=2,ve=i}function qe(){return Se?we:(Se=1,we=n.EventSource)}function Ue(){if(Te)return Ee;Te=1;var e=q(),t=Ne(),n=function(){if(_e)return be;_e=1;var e=q(),t=z().EventEmitter,n=qe(),r=function(){};function i(e){r(e),t.call(this);var i=this,o=this.es=new n(e);o.onmessage=function(e){r("message",e.data),i.emit("message",decodeURI(e.data))},o.onerror=function(e){r("error",o.readyState,e);var t=2!==o.readyState?"network":"permanent";i._cleanup(),i._close(t)}}return"production"!==process.env.NODE_ENV&&(r=P()("sockjs-client:receiver:eventsource")),e(i,t),i.prototype.abort=function(){r("abort"),this._cleanup(),this._close("user")},i.prototype._cleanup=function(){r("cleanup");var e=this.es;e&&(e.onmessage=e.onerror=null,e.close(),this.es=null)},i.prototype._close=function(e){r("close",e);var t=this;setTimeout((function(){t.emit("close",null,e),t.removeAllListeners()}),200)},be=i}(),r=Re(),i=qe();function o(e){if(!o.enabled())throw new Error("Transport created when disabled");t.call(this,e,"/eventsource",n,r)}return e(o,t),o.enabled=function(){return!!i},o.transportName="eventsource",o.roundTrips=2,Ee=o}function Ke(){return xe?Fe:(xe=1,Fe="1.6.1")}var We,Ve,Ge,ze,He,Je,Xe,$e,Ye,Qe,Ze,et,tt,nt,rt,it,ot,st,at,ct,ut,lt,dt,ft={exports:{}};function ht(){return We||(We=1,function(e){var t=S(),r=Pe(),i=function(){};"production"!==process.env.NODE_ENV&&(i=P()("sockjs-client:utils:iframe")),e.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){e.exports.WPrefix in n||(n[e.exports.WPrefix]={})},postMessage:function(t,r){n.parent!==n?n.parent.postMessage(JSON.stringify({windowId:e.exports.currentWindowId,type:t,data:r||""}),"*"):i("Cannot postMessage, no parent window.",t,r)},createIframe:function(e,r){var o,s,a=n.document.createElement("iframe"),c=function(){i("unattach"),clearTimeout(o);try{a.onload=null}catch(e){}a.onerror=null},u=function(){i("cleanup"),a&&(c(),setTimeout((function(){a&&a.parentNode.removeChild(a),a=null}),0),t.unloadDel(s))},l=function(e){i("onerror",e),a&&(u(),r(e))};return a.src=e,a.style.display="none",a.style.position="absolute",a.onerror=function(){l("onerror")},a.onload=function(){i("onload"),clearTimeout(o),o=setTimeout((function(){l("onload timeout")}),2e3)},n.document.body.appendChild(a),o=setTimeout((function(){l("timeout")}),15e3),s=t.unloadAdd(u),{post:function(e,t){i("post",e,t),setTimeout((function(){try{a&&a.contentWindow&&a.contentWindow.postMessage(e,t)}catch(n){}}),0)},cleanup:u,loaded:c}},createHtmlfile:function(r,o){var s,a,c,u=["Active"].concat("Object").join("X"),l=new n[u]("htmlfile"),d=function(){clearTimeout(s),c.onerror=null},f=function(){l&&(d(),t.unloadDel(a),c.parentNode.removeChild(c),c=l=null,CollectGarbage())},h=function(e){i("onerror",e),l&&(f(),o(e))};l.open(),l.write('<html><script>document.domain="'+n.document.domain+'";<\/script></html>'),l.close(),l.parentWindow[e.exports.WPrefix]=n[e.exports.WPrefix];var p=l.createElement("div");return l.body.appendChild(p),c=l.createElement("iframe"),p.appendChild(c),c.src=r,c.onerror=function(){h("onerror")},s=setTimeout((function(){h("timeout")}),15e3),a=t.unloadAdd(f),{post:function(e,t){try{setTimeout((function(){c&&c.contentWindow&&c.contentWindow.postMessage(e,t)}),0)}catch(n){}},cleanup:f,loaded:d}}},e.exports.iframeEnabled=!1,n.document&&(e.exports.iframeEnabled=("function"==typeof n.postMessage||"object"==typeof n.postMessage)&&!r.isKonqueror())}(ft)),ft.exports}function pt(){if(Ge)return Ve;Ge=1;var e=q(),t=z().EventEmitter,n=Ke(),r=A(),i=ht(),o=S(),s=w(),a=function(){};function c(e,n,u){if(!c.enabled())throw new Error("Transport created when disabled");t.call(this);var l=this;this.origin=r.getOrigin(u),this.baseUrl=u,this.transUrl=n,this.transport=e,this.windowId=s.string(8);var d=r.addPath(u,"/iframe.html")+"#"+this.windowId;a(e,n,d),this.iframeObj=i.createIframe(d,(function(e){a("err callback"),l.emit("close",1006,"Unable to load an iframe ("+e+")"),l.close()})),this.onmessageCallback=this._message.bind(this),o.attachEvent("message",this.onmessageCallback)}return"production"!==process.env.NODE_ENV&&(a=P()("sockjs-client:transport:iframe")),e(c,t),c.prototype.close=function(){if(a("close"),this.removeAllListeners(),this.iframeObj){o.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch(e){}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},c.prototype._message=function(e){if(a("message",e.data),r.isOriginEqual(e.origin,this.origin)){var t;try{t=JSON.parse(e.data)}catch(o){return void a("bad json",e.data)}if(t.windowId===this.windowId)switch(t.type){case"s":this.iframeObj.loaded(),this.postMessage("s",JSON.stringify([n,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",t.data);break;case"c":var i;try{i=JSON.parse(t.data)}catch(o){return void a("bad json",t.data)}this.emit("close",i[0],i[1]),this.close()}else a("mismatched window id",t.windowId,this.windowId)}else a("not same origin",e.origin,this.origin)},c.prototype.postMessage=function(e,t){a("postMessage",e,t),this.iframeObj.post(JSON.stringify({windowId:this.windowId,type:e,data:t||""}),this.origin)},c.prototype.send=function(e){a("send",e),this.postMessage("m",e)},c.enabled=function(){return i.iframeEnabled},c.transportName="iframe",c.roundTrips=2,Ve=c}function mt(){return He||(He=1,ze={isObject:function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},extend:function(e){if(!this.isObject(e))return e;for(var t,n,r=1,i=arguments.length;r<i;r++)for(n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}}),ze}function yt(){if(Xe)return Je;Xe=1;var e=q(),t=pt(),r=mt();return Je=function(i){function o(e,n){t.call(this,i.transportName,e,n)}return e(o,t),o.enabled=function(e,o){if(!n.document)return!1;var s=r.extend({},o);return s.sameOrigin=!0,i.enabled(s)&&t.enabled()},o.transportName="iframe-"+i.transportName,o.needBody=!0,o.roundTrips=t.roundTrips+i.roundTrips-1,o.facadeTransport=i,o},Je}function gt(){if(Ze)return Qe;Ze=1;var e=q(),t=function(){if(Ye)return $e;Ye=1;var e=q(),t=ht(),r=A(),i=z().EventEmitter,o=w(),s=function(){};function a(e){s(e),i.call(this);var c=this;t.polluteGlobalNamespace(),this.id="a"+o.string(6),e=r.addQuery(e,"c="+decodeURIComponent(t.WPrefix+"."+this.id)),s("using htmlfile",a.htmlfileEnabled);var u=a.htmlfileEnabled?t.createHtmlfile:t.createIframe;n[t.WPrefix][this.id]={start:function(){s("start"),c.iframeObj.loaded()},message:function(e){s("message",e),c.emit("message",e)},stop:function(){s("stop"),c._cleanup(),c._close("network")}},this.iframeObj=u(e,(function(){s("callback"),c._cleanup(),c._close("permanent")}))}"production"!==process.env.NODE_ENV&&(s=P()("sockjs-client:receiver:htmlfile")),e(a,i),a.prototype.abort=function(){s("abort"),this._cleanup(),this._close("user")},a.prototype._cleanup=function(){s("_cleanup"),this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete n[t.WPrefix][this.id]},a.prototype._close=function(e){s("_close",e),this.emit("close",null,e),this.removeAllListeners()},a.htmlfileEnabled=!1;var c=["Active"].concat("Object").join("X");if(c in n)try{a.htmlfileEnabled=!!new n[c]("htmlfile")}catch(u){}return a.enabled=a.htmlfileEnabled||t.iframeEnabled,$e=a}(),r=Le(),i=Ne();function o(e){if(!t.enabled)throw new Error("Transport created when disabled");i.call(this,e,"/htmlfile",t,r)}return e(o,i),o.enabled=function(e){return t.enabled&&e.sameOrigin},o.transportName="htmlfile",o.roundTrips=2,Qe=o}function vt(){if(tt)return et;tt=1;var e=q(),t=Ne(),n=je(),r=Re(),i=Le();function o(e){if(!i.enabled&&!r.enabled)throw new Error("Transport created when disabled");t.call(this,e,"/xhr",n,r)}return e(o,t),o.enabled=function(e){return!e.nullOrigin&&(!(!i.enabled||!e.sameOrigin)||r.enabled)},o.transportName="xhr-polling",o.roundTrips=2,et=o}function Ct(){if(rt)return nt;rt=1;var e=q(),t=Ne(),n=Be(),r=je(),i=De();function o(e){if(!i.enabled)throw new Error("Transport created when disabled");t.call(this,e,"/xhr",r,i)}return e(o,t),o.enabled=n.enabled,o.transportName="xdr-polling",o.roundTrips=2,nt=o}function wt(){if(at)return st;at=1;var e,t,r=w(),i=A(),o=function(){};return"production"!==process.env.NODE_ENV&&(o=P()("sockjs-client:sender:jsonp")),st=function(s,a,c){o(s,a),e||(o("createForm"),(e=n.document.createElement("form")).style.display="none",e.style.position="absolute",e.method="POST",e.enctype="application/x-www-form-urlencoded",e.acceptCharset="UTF-8",(t=n.document.createElement("textarea")).name="d",e.appendChild(t),n.document.body.appendChild(e));var u="a"+r.string(8);e.target=u,e.action=i.addQuery(i.addPath(s,"/jsonp_send"),"i="+u);var l=function(e){o("createIframe",e);try{return n.document.createElement('<iframe name="'+e+'">')}catch(r){var t=n.document.createElement("iframe");return t.name=e,t}}(u);l.id=u,l.style.display="none",e.appendChild(l);try{t.value=a}catch(f){}e.submit();var d=function(e){o("completed",u,e),l.onerror&&(l.onreadystatechange=l.onerror=l.onload=null,setTimeout((function(){o("cleaning up",u),l.parentNode.removeChild(l),l=null}),500),t.value="",c(e))};return l.onerror=function(){o("onerror",u),d()},l.onload=function(){o("onload",u),d()},l.onreadystatechange=function(e){o("onreadystatechange",u,l.readyState,e),"complete"===l.readyState&&d()},function(){o("aborted",u),d(new Error("Aborted"))}},st}function St(){if(ut)return ct;ut=1;var e=q(),t=Oe(),r=function(){if(ot)return it;ot=1;var e=ht(),t=w(),r=Pe(),i=A(),o=q(),s=z().EventEmitter,a=function(){};function c(r){a(r);var o=this;s.call(this),e.polluteGlobalNamespace(),this.id="a"+t.string(6);var u=i.addQuery(r,"c="+encodeURIComponent(e.WPrefix+"."+this.id));n[e.WPrefix][this.id]=this._callback.bind(this),this._createScript(u),this.timeoutId=setTimeout((function(){a("timeout"),o._abort(new Error("JSONP script loaded abnormally (timeout)"))}),c.timeout)}return"production"!==process.env.NODE_ENV&&(a=P()("sockjs-client:receiver:jsonp")),o(c,s),c.prototype.abort=function(){if(a("abort"),n[e.WPrefix][this.id]){var t=new Error("JSONP user aborted read");t.code=1e3,this._abort(t)}},c.timeout=35e3,c.scriptErrorTimeout=1e3,c.prototype._callback=function(e){a("_callback",e),this._cleanup(),this.aborting||(e&&(a("message",e),this.emit("message",e)),this.emit("close",null,"network"),this.removeAllListeners())},c.prototype._abort=function(e){a("_abort",e),this._cleanup(),this.aborting=!0,this.emit("close",e.code,e.message),this.removeAllListeners()},c.prototype._cleanup=function(){if(a("_cleanup"),clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var t=this.script;t.parentNode.removeChild(t),t.onreadystatechange=t.onerror=t.onload=t.onclick=null,this.script=null}delete n[e.WPrefix][this.id]},c.prototype._scriptError=function(){a("_scriptError");var e=this;this.errorTimer||(this.errorTimer=setTimeout((function(){e.loadedOkay||e._abort(new Error("JSONP script loaded abnormally (onerror)"))}),c.scriptErrorTimeout))},c.prototype._createScript=function(e){a("_createScript",e);var i,o=this,s=this.script=n.document.createElement("script");if(s.id="a"+t.string(8),s.src=e,s.type="text/javascript",s.charset="UTF-8",s.onerror=this._scriptError.bind(this),s.onload=function(){a("onload"),o._abort(new Error("JSONP script loaded abnormally (onload)"))},s.onreadystatechange=function(){if(a("onreadystatechange",s.readyState),/loaded|closed/.test(s.readyState)){if(s&&s.htmlFor&&s.onclick){o.loadedOkay=!0;try{s.onclick()}catch(e){}}s&&o._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof s.async&&n.document.attachEvent)if(r.isOpera())(i=this.script2=n.document.createElement("script")).text="try{var a = document.getElementById('"+s.id+"'); if(a)a.onerror();}catch(x){};",s.async=i.async=!1;else{try{s.htmlFor=s.id,s.event="onclick"}catch(u){}s.async=!0}"undefined"!=typeof s.async&&(s.async=!0);var c=n.document.getElementsByTagName("head")[0];c.insertBefore(s,c.firstChild),i&&c.insertBefore(i,c.firstChild)},it=c}(),i=wt();function o(e){if(!o.enabled())throw new Error("Transport created when disabled");t.call(this,e,"/jsonp",i,r)}return e(o,t),o.enabled=function(){return!!n.document},o.transportName="jsonp-polling",o.roundTrips=1,o.needBody=!0,ct=o}function bt(){return dt?lt:(dt=1,lt=[Ie(),Ae(),Be(),Ue(),yt()(Ue()),gt(),yt()(gt()),vt(),Ct(),yt()(vt()),St()])}var _t,Et,Tt,Ft,xt,kt,It,Ot,Nt,jt,Mt,Rt,Lt,Pt,At,Dt,Bt,qt,Ut,Kt,Wt,Vt,Gt,zt,Ht,Jt,Xt,$t,Yt,Qt,Zt,en,tn,nn={};function rn(){if(Tt)return Et;Tt=1;var e,t=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g;return Et={quote:function(n){var r=JSON.stringify(n);return t.lastIndex=0,t.test(r)?(e||(e=function(e){var t,n={},r=[];for(t=0;t<65536;t++)r.push(String.fromCharCode(t));return e.lastIndex=0,r.join("").replace(e,(function(e){return n[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""})),e.lastIndex=0,n}(t)),r.replace(t,(function(t){return e[t]}))):r}}}function on(){if(xt)return Ft;xt=1;var e=function(){};return"production"!==process.env.NODE_ENV&&(e=P()("sockjs-client:utils:transport")),Ft=function(t){return{filterToEnabled:function(n,r){var i={main:[],facade:[]};return n?"string"==typeof n&&(n=[n]):n=[],t.forEach((function(t){t&&("websocket"!==t.transportName||!1!==r.websocket?n.length&&-1===n.indexOf(t.transportName)?e("not in whitelist",t.transportName):t.enabled(r)?(e("enabled",t.transportName),i.main.push(t),t.facadeTransport&&i.facade.push(t.facadeTransport)):e("disabled",t.transportName):e("disabled from server","websocket"))})),i}}}}function sn(){if(It)return kt;It=1;var e={};return["log","debug","warn"].forEach((function(t){var r;try{r=n.console&&n.console[t]&&n.console[t].apply}catch(i){}e[t]=r?function(){return n.console[t].apply(n.console,arguments)}:"log"===t?function(){}:e.log})),kt=e}function an(){if(Nt)return Ot;function e(e){this.type=e}return Nt=1,e.prototype.initEvent=function(e,t,n){return this.type=e,this.bubbles=t,this.cancelable=n,this.timeStamp=+new Date,this},e.prototype.stopPropagation=function(){},e.prototype.preventDefault=function(){},e.CAPTURING_PHASE=1,e.AT_TARGET=2,e.BUBBLING_PHASE=3,Ot=e}function cn(){return Mt?jt:(Mt=1,jt=n.location||{origin:"http://localhost:80",protocol:"http:",host:"localhost",port:80,href:"http://localhost/",hash:""})}function un(){if(Ut)return qt;Ut=1;var e=z().EventEmitter,t=q(),n=mt(),r=function(){};function i(t,i){e.call(this);var o=this,s=+new Date;this.xo=new i("GET",t),this.xo.once("finish",(function(e,t){var i,a;if(200===e){if(a=+new Date-s,t)try{i=JSON.parse(t)}catch(c){r("bad json",t)}n.isObject(i)||(i={})}o.emit("finish",i,a),o.removeAllListeners()}))}return"production"!==process.env.NODE_ENV&&(r=P()("sockjs-client:info-ajax")),t(i,e),i.prototype.close=function(){this.removeAllListeners(),this.xo.close()},qt=i}function ln(){if(Wt)return Kt;Wt=1;var e=q(),t=z().EventEmitter,n=Le(),r=un();function i(e){var i=this;t.call(this),this.ir=new r(e,n),this.ir.once("finish",(function(e,t){i.ir=null,i.emit("message",JSON.stringify([e,t]))}))}return e(i,t),i.transportName="iframe-info-receiver",i.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},Kt=i}function dn(){if(Ht)return zt;Ht=1;var e=z().EventEmitter,t=q(),r=A(),i=De(),o=Re(),s=Le(),a=function(){if(Bt)return Dt;Bt=1;var e=z().EventEmitter;function t(){var n=this;e.call(this),this.to=setTimeout((function(){n.emit("finish",200,"{}")}),t.timeout)}return q()(t,e),t.prototype.close=function(){clearTimeout(this.to)},t.timeout=2e3,Dt=t}(),c=function(){if(Gt)return Vt;Gt=1;var e=z().EventEmitter,t=q(),r=S(),i=pt(),o=ln(),s=function(){};function a(t,a){var c=this;e.call(this);var u=function(){var e=c.ifr=new i(o.transportName,a,t);e.once("message",(function(e){if(e){var t;try{t=JSON.parse(e)}catch(i){return s("bad json",e),c.emit("finish"),void c.close()}var n=t[0],r=t[1];c.emit("finish",n,r)}c.close()})),e.once("close",(function(){c.emit("finish"),c.close()}))};n.document.body?u():r.attachEvent("load",u)}return"production"!==process.env.NODE_ENV&&(s=P()("sockjs-client:info-iframe")),t(a,e),a.enabled=function(){return i.enabled()},a.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},Vt=a}(),u=un(),l=function(){};function d(t,n){l(t);var r=this;e.call(this),setTimeout((function(){r.doXhr(t,n)}),0)}return"production"!==process.env.NODE_ENV&&(l=P()("sockjs-client:info-receiver")),t(d,e),d._getReceiver=function(e,t,n){return n.sameOrigin?new u(t,s):o.enabled?new u(t,o):i.enabled&&n.sameScheme?new u(t,i):c.enabled()?new c(e,t):new u(t,a)},d.prototype.doXhr=function(e,t){var n=this,i=r.addPath(e,"/info");l("doXhr",i),this.xo=d._getReceiver(e,i,t),this.timeoutRef=setTimeout((function(){l("timeout"),n._cleanup(!1),n.emit("finish")}),d.timeout),this.xo.once("finish",(function(e,t){l("finish",e,t),n._cleanup(!0),n.emit("finish",e,t)}))},d.prototype._cleanup=function(e){l("_cleanup"),clearTimeout(this.timeoutRef),this.timeoutRef=null,!e&&this.xo&&this.xo.close(),this.xo=null},d.prototype.close=function(){l("close"),this.removeAllListeners(),this._cleanup(!1)},d.timeout=8e3,zt=d}function fn(){if(Yt)return $t;Yt=1;var e=A(),t=S(),n=function(){if(Xt)return Jt;Xt=1;var e=ht();function t(e){this._transport=e,e.on("message",this._transportMessage.bind(this)),e.on("close",this._transportClose.bind(this))}return t.prototype._transportClose=function(t,n){e.postMessage("c",JSON.stringify([t,n]))},t.prototype._transportMessage=function(t){e.postMessage("t",t)},t.prototype._send=function(e){this._transport.send(e)},t.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},Jt=t}(),r=ln(),i=ht(),o=cn(),s=function(){};return"production"!==process.env.NODE_ENV&&(s=P()("sockjs-client:iframe-bootstrap")),$t=function(a,c){var u,l={};c.forEach((function(e){e.facadeTransport&&(l[e.facadeTransport.transportName]=e.facadeTransport)})),l[r.transportName]=r,a.bootstrap_iframe=function(){var r;i.currentWindowId=o.hash.slice(1);t.attachEvent("message",(function(t){if(t.source===parent&&(void 0===u&&(u=t.origin),t.origin===u)){var c;try{c=JSON.parse(t.data)}catch(y){return void s("bad json",t.data)}if(c.windowId===i.currentWindowId)switch(c.type){case"s":var d;try{d=JSON.parse(c.data)}catch(y){s("bad json",c.data);break}var f=d[0],h=d[1],p=d[2],m=d[3];if(s(f,h,p,m),f!==a.version)throw new Error('Incompatible SockJS! Main site uses: "'+f+'", the iframe: "'+a.version+'".');if(!e.isOriginEqual(p,o.href)||!e.isOriginEqual(m,o.href))throw new Error("Can't connect to different domain from within an iframe. ("+o.href+", "+p+", "+m+")");r=new n(new l[h](p,m));break;case"m":r._send(c.data);break;case"c":r&&r._close(),r=null}}})),i.postMessage("s")}},$t}function hn(){if(Zt)return Qt;Zt=1,function(){if(_t)return nn;_t=1;var e,t=Array.prototype,n=Object.prototype,r=Function.prototype,i=String.prototype,o=t.slice,s=n.toString,a=function(e){return"[object Function]"===n.toString.call(e)},c=function(e){return"[object String]"===s.call(e)},u=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}();e=u?function(e,t,n,r){!r&&t in e||Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:n})}:function(e,t,n,r){!r&&t in e||(e[t]=n)};var l=function(t,r,i){for(var o in r)n.hasOwnProperty.call(r,o)&&e(t,o,r[o],i)},d=function(e){if(null==e)throw new TypeError("can't convert "+e+" to object");return Object(e)};function f(e){var t=+e;return t!=t?t=0:0!==t&&t!==1/0&&t!==-1/0&&(t=(t>0||-1)*Math.floor(Math.abs(t))),t}function h(){}l(r,{bind:function(e){var t=this;if(!a(t))throw new TypeError("Function.prototype.bind called on incompatible "+t);for(var n=o.call(arguments,1),r=function(){if(this instanceof u){var r=t.apply(this,n.concat(o.call(arguments)));return Object(r)===r?r:this}return t.apply(e,n.concat(o.call(arguments)))},i=Math.max(0,t.length-n.length),s=[],c=0;c<i;c++)s.push("$"+c);var u=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this, arguments); }")(r);return t.prototype&&(h.prototype=t.prototype,u.prototype=new h,h.prototype=null),u}}),l(Array,{isArray:function(e){return"[object Array]"===s.call(e)}});var p,m,y,g=Object("a"),v="a"!==g[0]||!(0 in g);l(t,{forEach:function(e){var t=d(this),n=v&&c(this)?this.split(""):t,r=arguments[1],i=-1,o=n.length>>>0;if(!a(e))throw new TypeError;for(;++i<o;)i in n&&e.call(r,n[i],i,t)}},(p=t.forEach,m=!0,y=!0,p&&(p.call("foo",(function(e,t,n){"object"!=typeof n&&(m=!1)})),p.call([1],(function(){y="string"==typeof this}),"x")),!(p&&m&&y)));var C=Array.prototype.indexOf&&-1!==[0,1].indexOf(1,2);l(t,{indexOf:function(e){var t=v&&c(this)?this.split(""):d(this),n=t.length>>>0;if(!n)return-1;var r=0;for(arguments.length>1&&(r=f(arguments[1])),r=r>=0?r:Math.max(0,n+r);r<n;r++)if(r in t&&t[r]===e)return r;return-1}},C);var w,S=i.split;2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||".".split(/()()/).length>1?(w=void 0===/()??/.exec("")[1],i.split=function(e,n){var r=this;if(void 0===e&&0===n)return[];if("[object RegExp]"!==s.call(e))return S.call(this,e,n);var i,o,a,c,u=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.extended?"x":"")+(e.sticky?"y":""),d=0;for(e=new RegExp(e.source,l+"g"),r+="",w||(i=new RegExp("^"+e.source+"$(?!\\s)",l)),n=void 0===n?-1>>>0:n>>>0;(o=e.exec(r))&&!((a=o.index+o[0].length)>d&&(u.push(r.slice(d,o.index)),!w&&o.length>1&&o[0].replace(i,(function(){for(var e=1;e<arguments.length-2;e++)void 0===arguments[e]&&(o[e]=void 0)})),o.length>1&&o.index<r.length&&t.push.apply(u,o.slice(1)),c=o[0].length,d=a,u.length>=n));)e.lastIndex===o.index&&e.lastIndex++;return d===r.length?!c&&e.test("")||u.push(""):u.push(r.slice(d)),u.length>n?u.slice(0,n):u}):"0".split(void 0,0).length&&(i.split=function(e,t){return void 0===e&&0===t?[]:S.call(this,e,t)});var b=i.substr,_="".substr&&"b"!=="0b".substr(-1);l(i,{substr:function(e,t){return b.call(this,e<0&&(e=this.length+e)<0?0:e,t)}},_)}();var e,t=F(),r=q(),i=w(),o=rn(),s=A(),a=S(),c=on(),u=mt(),l=Pe(),d=sn(),f=an(),h=G(),p=cn(),m=function(){if(Lt)return Rt;Lt=1;var e=q(),t=an();function n(){t.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}return e(n,t),Rt=n}(),y=function(){if(At)return Pt;At=1;var e=q(),t=an();function n(e){t.call(this),this.initEvent("message",!1,!1),this.data=e}return e(n,t),Pt=n}(),g=dn(),v=function(){};function C(e,n,r){if(!(this instanceof C))return new C(e,n,r);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");h.call(this),this.readyState=C.CONNECTING,this.extensions="",this.protocol="",(r=r||{}).protocols_whitelist&&d.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=r.transports,this._transportOptions=r.transportOptions||{},this._timeout=r.timeout||0;var o=r.sessionId||8;if("function"==typeof o)this._generateSessionId=o;else{if("number"!=typeof o)throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._generateSessionId=function(){return i.string(o)}}this._server=r.server||i.numberString(1e3);var a=new t(e);if(!a.host||!a.protocol)throw new SyntaxError("The URL '"+e+"' is invalid");if(a.hash)throw new SyntaxError("The URL must not contain a fragment");if("http:"!==a.protocol&&"https:"!==a.protocol)throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+a.protocol+"' is not allowed.");var c="https:"===a.protocol;if("https:"===p.protocol&&!c&&!s.isLoopbackAddr(a.hostname))throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");n?Array.isArray(n)||(n=[n]):n=[];var u=n.sort();u.forEach((function(e,t){if(!e)throw new SyntaxError("The protocols entry '"+e+"' is invalid.");if(t<u.length-1&&e===u[t+1])throw new SyntaxError("The protocols entry '"+e+"' is duplicated.")}));var f=s.getOrigin(p.href);this._origin=f?f.toLowerCase():null,a.set("pathname",a.pathname.replace(/\/+$/,"")),this.url=a.href,v("using url",this.url),this._urlInfo={nullOrigin:!l.hasDomain(),sameOrigin:s.isOriginEqual(this.url,p.href),sameScheme:s.isSchemeEqual(this.url,p.href)},this._ir=new g(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}function b(e){return 1e3===e||e>=3e3&&e<=4999}return"production"!==process.env.NODE_ENV&&(v=P()("sockjs-client:main")),r(C,h),C.prototype.close=function(e,t){if(e&&!b(e))throw new Error("InvalidAccessError: Invalid code");if(t&&t.length>123)throw new SyntaxError("reason argument has an invalid length");if(this.readyState!==C.CLOSING&&this.readyState!==C.CLOSED){this._close(e||1e3,t||"Normal closure",!0)}},C.prototype.send=function(e){if("string"!=typeof e&&(e=""+e),this.readyState===C.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===C.OPEN&&this._transport.send(o.quote(e))},C.version=Ke(),C.CONNECTING=0,C.OPEN=1,C.CLOSING=2,C.CLOSED=3,C.prototype._receiveInfo=function(t,n){if(v("_receiveInfo",n),this._ir=null,t){this._rto=this.countRTO(n),this._transUrl=t.base_url?t.base_url:this.url,t=u.extend(t,this._urlInfo),v("info",t);var r=e.filterToEnabled(this._transportsWhitelist,t);this._transports=r.main,v(this._transports.length+" enabled transports"),this._connect()}else this._close(1002,"Cannot connect to server")},C.prototype._connect=function(){for(var e=this._transports.shift();e;e=this._transports.shift()){if(v("attempt",e.transportName),e.needBody&&(!n.document.body||"undefined"!=typeof n.document.readyState&&"complete"!==n.document.readyState&&"interactive"!==n.document.readyState))return v("waiting for body"),this._transports.unshift(e),void a.attachEvent("load",this._connect.bind(this));var t=Math.max(this._timeout,this._rto*e.roundTrips||5e3);this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),t),v("using timeout",t);var r=s.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),i=this._transportOptions[e.transportName];v("transport url",r);var o=new e(r,this._transUrl,i);return o.on("message",this._transportMessage.bind(this)),o.once("close",this._transportClose.bind(this)),o.transportName=e.transportName,void(this._transport=o)}this._close(2e3,"All transports failed",!1)},C.prototype._transportTimeout=function(){v("_transportTimeout"),this.readyState===C.CONNECTING&&(this._transport&&this._transport.close(),this._transportClose(2007,"Transport timed out"))},C.prototype._transportMessage=function(e){v("_transportMessage",e);var t,n=this,r=e.slice(0,1),i=e.slice(1);switch(r){case"o":return void this._open();case"h":return this.dispatchEvent(new f("heartbeat")),void v("heartbeat",this.transport)}if(i)try{t=JSON.parse(i)}catch(o){v("bad json",i)}if(void 0!==t)switch(r){case"a":Array.isArray(t)&&t.forEach((function(e){v("message",n.transport,e),n.dispatchEvent(new y(e))}));break;case"m":v("message",this.transport,t),this.dispatchEvent(new y(t));break;case"c":Array.isArray(t)&&2===t.length&&this._close(t[0],t[1],!0)}else v("empty payload",i)},C.prototype._transportClose=function(e,t){v("_transportClose",this.transport,e,t),this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),b(e)||2e3===e||this.readyState!==C.CONNECTING?this._close(e,t):this._connect()},C.prototype._open=function(){v("_open",this._transport&&this._transport.transportName,this.readyState),this.readyState===C.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=C.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new f("open")),v("connected",this.transport)):this._close(1006,"Server lost session")},C.prototype._close=function(e,t,n){v("_close",this.transport,e,t,n,this.readyState);var r=!1;if(this._ir&&(r=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===C.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=C.CLOSING,setTimeout(function(){this.readyState=C.CLOSED,r&&this.dispatchEvent(new f("error"));var i=new m("close");i.wasClean=n||!1,i.code=e||1e3,i.reason=t,this.dispatchEvent(i),this.onmessage=this.onclose=this.onerror=null,v("disconnected")}.bind(this),0)},C.prototype.countRTO=function(e){return e>100?4*e:300+e},Qt=function(t){return e=c(t),fn()(C,t),C}}var pn={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.MsgMod=void 0,(t=e.MsgMod||(e.MsgMod={})).File="0",t.Mem="1"}(pn);var mn,yn={};function gn(){return mn||(mn=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SocketContext=e.SocketContextError=e.SocketContextErrorCode=void 0;const t=Nn(),n=_n(),r=pn;var i;!function(e){e.CONVERT_PARAM="CONVERT_PARAM",e.OPERATION_FILE="OPERATION_FILE",e.NO_REED_RETURN="NO_REED_RETURN",e.IS_RETURN_OK="IS_RETURN_OK",e.TIMEOUT="TIMEOUT",e.MSG_SEND="MSG_SEND",e.CONNECTION_SERVER="CONNECTION_SERVER"}(i=e.SocketContextErrorCode||(e.SocketContextErrorCode={}));class o extends Error{constructor(e,t,n){super(t),this.name="socketContextError",this._srcErr=n,this._code=e}get srcErr(){return this._srcErr}get code(){return this._code}}e.SocketContextError=o;class s{constructor(e,t,n,r,i){this._fields=[],this._fieldsInfoMap={},this._isDestroy=!1,this._isVoid=!1,this._isReturnOk=!1,this._needReturn=!1,this._childrenContext=[],this._cmd=e,this._needReturn=t,this._msgId=n,this._mod=r,this._data=i,i.length<=0||this.parseFields()}get isReturnOk(){const e=this._isReturnOk;return e||(this._isReturnOk=!0),e}get needReturn(){const e=this._needReturn;return e&&(this._needReturn=!1),e}get sendInfo(){const e=this._sendInfo;return this._sendInfo=undefined,e}get isVoid(){return this._isVoid}get err(){return this._err}get fields(){return this._fields}get data(){return this._data}get cmd(){return this._cmd}get msgId(){return this._msgId}get mod(){return this._mod}static createSendMsgContext(e,a={}){const c=a.mod===r.MsgMod.Mem||a.mod===r.MsgMod.File?a.mod:n.WebsocketClient.requireFn?r.MsgMod.File:r.MsgMod.Mem,u=a&&a.needReturn||!1;let l;const d=`${Math.random()}-${(new Date).getTime()}`,f=new s(e,!1,d,c,"");try{l=c===r.MsgMod.Mem?a&&"undefined"!=typeof a.data?t.marshal(a.data):t.marshalVoid():a&&"undefined"!==a.data?t.marshal2FilePath(a.data):t.marshalVoid2FilePath()}catch(h){return f._err=new o(i.CONVERT_PARAM,"参数转换异常",h),f}return f._sendInfo={cmd:e,msgId:d,mod:c,data:l,needReturn:u,timeout:a&&a.timeout},f}parseFields(){"0"===this._mod?this.parseFileFields():this.parseMemFields()}parseFileFields(){try{const e=n.WebsocketClient.requireFn("fs"),{Buffer:r}=n.WebsocketClient.requireFn("buffer");this._fd=e.openSync(this.data,"r");const i=r.alloc(1);e.readSync(this._fd,i,0,1,0);const s=i.toString("utf-8");if(t.dataIsVoid(s))return void(this._isVoid=!0);if(t.dataIsError(s)){const n=t.unmarshalErrByFile(e,this._fd,r);return void(this._err=new o(n.code,n.msg,undefined))}this._fieldsInfoMap=t.unmarshalFieldInfoByFile(e,this._fd,r)}catch(e){this._err=new o(i.OPERATION_FILE,"操作文件失败",e)}}parseMemFields(){const e=this._data[0];if(t.dataIsVoid(e))this._isVoid=!0;else if(t.dataIsError(e)){const e=t.unmarshalErr(this._data);this._err=new o(e.code,e.msg,undefined)}else this._fieldsInfoMap=t.unmarshalFieldInfo(this._data)}unmarshal(){return"0"===this.mod?t.unmarshalByFilePath(this.data):t.unmarshal(this.data)}settingChildrenContext(e){this._childrenContext.push(e)}param(e){return this._fieldsInfoMap[e]}async returnVoid(e={}){let n;return n=this.mod===r.MsgMod.Mem?t.marshalVoid():t.marshalVoid2FilePath(),this.returnMsg(n,e)}async returnErr(e,n,i={}){let o;return o=this.mod===r.MsgMod.Mem?t.marshalErr(e,n):t.marshalErr2FilePath(e,n),this.returnMsg(o,i)}async returnObj(e,n={}){let i;return i=this._mod===r.MsgMod.Mem?t.marshal(e):t.marshal2FilePath(e),this.returnMsg(i,n)}async returnMsg(e,t={}){return this.needReturn?this.isReturnOk?Promise.reject(new o(i.IS_RETURN_OK,"已经正常返回过了, 请勿重复返回")):(this._sendInfo={msgId:this.msgId,mod:this._mod,data:e,timeout:t.timeout,needReturn:t.needReturn},await n.WebsocketClient.getConn().sendMsg(this)):Promise.reject(new o(i.NO_REED_RETURN,"不需要进行返回"))}async destroy(){if(!this._isDestroy){if(n.WebsocketClient.rmWaitMsg(this._msgId),!this.isReturnOk&&this.needReturn)try{const e=t.marshalVoid();this._sendInfo={data:e,mod:r.MsgMod.Mem,msgId:this._msgId},await n.WebsocketClient.getConn().sendMsg(this)}catch(e){}if(this._cmd="",this._fields=[],this._err=undefined,this._fieldsInfoMap={},this._msgId="","0"===this._mod)try{n.WebsocketClient.requireFn("fs").unlinkSync(this._data)}catch(e){}if(this._mod="",this._data="",this._childrenContext.length>0)for(let e of this._childrenContext)e.destroy().then((e=>{}))["catch"]((e=>{}));this._childrenContext=[],this._isDestroy=!0}}}e.SocketContext=s,s._fieldSplitChar=";"}(yn)),yn}var vn,Cn,wn,Sn={};function bn(){if(vn)return Sn;function e(t){if(t=t||{},this.Promise=t.Promise||Promise,this.queues=Object.create(null),this.domainReentrant=t.domainReentrant||!1,this.domainReentrant){if("undefined"==typeof process||"undefined"==typeof process.domain)throw new Error("Domain-reentrant locks require `process.domain` to exist. Please flip `opts.domainReentrant = false`, use a NodeJS version that still implements Domain, or install a browser polyfill.");this.domains=Object.create(null)}this.timeout=t.timeout||e.DEFAULT_TIMEOUT,this.maxOccupationTime=t.maxOccupationTime||e.DEFAULT_MAX_OCCUPATION_TIME,t.maxPending===Infinity||Number.isInteger(t.maxPending)&&t.maxPending>=0?this.maxPending=t.maxPending:this.maxPending=e.DEFAULT_MAX_PENDING}return vn=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn["default"]=e,e.DEFAULT_TIMEOUT=0,e.DEFAULT_MAX_OCCUPATION_TIME=0,e.DEFAULT_MAX_PENDING=1e3,e.prototype.acquire=function(e,t,n,r){if(Array.isArray(e))return this._acquireBatch(e,t,n,r);if("function"!=typeof t)throw new Error("You must pass a function to execute");var i=null,o=null,s=null;"function"!=typeof n&&(r=n,n=null,s=new this.Promise((function(e,t){i=e,o=t}))),r=r||{};var a=!1,c=null,u=null,l=this,d=function(t,r,c){u&&(clearTimeout(u),u=null),t&&(l.queues[e]&&0===l.queues[e].length&&delete l.queues[e],l.domainReentrant&&delete l.domains[e]),a||(s?r?o(r):i(c):"function"==typeof n&&n(r,c),a=!0),t&&l.queues[e]&&l.queues[e].length>0&&l.queues[e].shift()()},f=function(n){if(a)return d(n);if(c&&(clearTimeout(c),c=null),l.domainReentrant&&n&&(l.domains[e]=process.domain),1===t.length){var r=!1;t((function(e,t){r||(r=!0,d(n,e,t))}))}else l._promiseTry((function(){return t()})).then((function(e){d(n,undefined,e)}),(function(e){d(n,e)}))};if(l.domainReentrant&&process.domain&&(f=process.domain.bind(f)),l.queues[e])if(l.domainReentrant&&process.domain&&process.domain===l.domains[e])f(!1);else if(l.queues[e].length>=l.maxPending)d(!1,new Error("Too much pending tasks"));else{var h=function(){f(!0)};r.skipQueue?l.queues[e].unshift(h):l.queues[e].push(h);var p=r.timeout||l.timeout;p&&(c=setTimeout((function(){c=null,d(!1,new Error("async-lock timed out"))}),p))}else l.queues[e]=[],f(!0);var m=r.maxOccupationTime||l.maxOccupationTime;return m&&(u=setTimeout((function(){l.queues[e]&&d(!1,new Error("Maximum occupation time is exceeded"))}),m)),s||void 0},e.prototype._acquireBatch=function(e,t,n,r){"function"!=typeof n&&(r=n,n=null);var i=this,o=t;if(e.reverse().forEach((function(e){o=function(e,t){return function(n){i.acquire(e,t,n,r)}}(e,o)})),"function"!=typeof n)return new this.Promise((function(e,t){1===o.length?o((function(n,r){n?t(n):e(r)})):e(o())}));o(n)},e.prototype.isBusy=function(e){return e?!!this.queues[e]:Object.keys(this.queues).length>0},e.prototype._promiseTry=function(e){try{return this.Promise.resolve(e())}catch(t){return this.Promise.reject(t)}},Sn}function _n(){if(Cn)return g;Cn=1;var e=n&&n.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(g,"__esModule",{value:!0}),g.SocketMsgHandler=g.WebsocketClient=void 0;const t=e(function(){if(tn)return en;tn=1;var e=bt();return en=hn()(e),"_sockjs_onload"in n&&setTimeout(n._sockjs_onload,1),en}()),r=pn,i=gn(),o=u,s=Nn(),a=new(e(bn())["default"]),c="\r\n0\r\n";let l=1048576;class d{constructor(e){this.isOpen=!1,this.msgHandler=new f,this.url=e,this.init()}static set requireFn(e){this._requireFn=e}static get requireFn(){return this._requireFn}init(){this.conn=new t["default"](this.url),this.conn.onopen=async()=>{if(this.isOpen=!0,this.lastErr=undefined,d.hookFn.open){const e=d.hookFn.open(this);e instanceof Promise&&await e}},this.conn.onerror=e=>{this.lastErr=e},this.conn.onclose=()=>{this.closeConnection()},this.conn.onmessage=async e=>{const t=this.msgHandler.handle(e.data);if(t&&!(t.length<=0))for(let e of t)if(e.cmd)try{const t=d.socketEventHandleMap[e.cmd];if(!t){await e.returnErr("500","未知的请求命令");continue}const r=t(e);r instanceof Promise&&await r}catch(n){try{await e.returnErr("500",n.message)}catch(n){}}finally{try{await e.destroy()}catch(n){}}else{const t=d.socketMsgWaitMap[e.msgId];t?(t.timeoutId&&clearTimeout(t.timeoutId),t.context.settingChildrenContext(e),t.resolve(e)):await e.returnErr("NO_WAIT_MSG","没有等待的处理器"),delete d.socketMsgWaitMap[e.msgId]}}}closeConnection(){this.conn&&this.conn.close(),this.isOpen=!1;for(let e in d.socketMsgWaitMap){const t=d.socketMsgWaitMap[e];if(!t||!t.context)continue;const n=new i.SocketContext("",!1,t.context.msgId,r.MsgMod.Mem,s.marshalErr(i.SocketContextErrorCode.CONNECTION_SERVER,"服务连接断开"));n.settingChildrenContext(n),t.resolve(n),t.context.destroy().then((()=>{}))["catch"]((()=>{}))}d.hookFn.close&&d.hookFn.close(this),this.msgHandler.clearDataFlag()}reconnection(){this.conn&&this.conn.close(),this.init()}_sendMsg(e){this.conn.send(e)}sendMsg(e){const t=e.sendInfo;return new Promise((async(n,s)=>{a.acquire("key",(async a=>{try{if(!this.isOpen)return void s(new i.SocketContextError(i.SocketContextErrorCode.CONNECTION_SERVER,"未与服务器建立连接"));if(t.needReturn){const r={context:e,resolve:n,reject:s};t.timeout&&t.timeout>0&&(r.timeoutId=setTimeout((()=>{s(new i.SocketContextError(i.SocketContextErrorCode.TIMEOUT,"接收返回值超时"))}),t.timeout)),d.socketMsgWaitMap[t.msgId]=r}const f=t.needReturn?"1":"0",h=`${t.cmd||""}\n${f}\n${t.msgId}\n${t.mod}\n`;try{if(this._sendMsg(h),t.mod===r.MsgMod.File)this._sendMsg(`${t.data}\n`);else{const e=t.data.length;if(e<=l)this._sendMsg(`${t.data}`);else{const n=Math.ceil(e/l);for(let e=0;e<n;e++){const n=e*l,r=(e+1)*l;this._sendMsg(t.data.substring(n,r))}}this._sendMsg(c)}t.needReturn||n(new i.SocketContext(e.cmd,e.needReturn,e.msgId,r.MsgMod.Mem,o.FieldType.VOID+"\n"))}catch(u){try{if(t.mod===r.MsgMod.File){d.requireFn("fs").unlinkSync(t.data)}}catch(u){}s(u)}}finally{a()}}))}))}static registryEventHandle(e,t){d.socketEventHandleMap[e]=t}static registryWebsocketHook(e,t){d.hookFn[e]=t}static rmWaitMsg(e){delete d.socketMsgWaitMap[e]}static clearWaitMsgMap(){d.socketMsgWaitMap={}}static init(e){if(e||(e={}),d._requireFn=e.requireFn,!d.instance)return e.url||(e.url="https://127.0.0.1:65528/dev"),void(d.instance=new d(e.url));d.instance.lastErr&&d.instance.reconnection(),e.maxMsgBlockSize||(e.maxMsgBlockSize=1048576),l=e.maxMsgBlockSize}static getConn(e){return d.instance?(d.instance.lastErr&&d.instance.reconnection(),d.instance):(d.init(e),d.instance)}}g.WebsocketClient=d,d.hookFn={},d.socketEventHandleMap={},d.socketMsgWaitMap={};class f{constructor(){this.newLine="\n",this.tmpMsg="",this.isFirst=!0}handle(e){const t=[];for(e=this.tmpMsg+e,this.tmpMsg="";;){const n=this.handleMsg(e);if(!n)break;t.push(n),e=this.tmpMsg}return t}handleMsg(e){if(0===e.length)return;const t=[e];if(!this.cmd&&this.isFirst&&e[0]!==this.newLine){const e=this.readLineContent(t);if(!e.canNext)return;this.cmd=e.content}else!this.cmd&&this.isFirst&&e[0]===this.newLine&&this.readLineContent(t);if(this.isFirst=!1,"undefined"==typeof this.needReturn){const e=this.readLineContent(t);if(!e.canNext)return;this.needReturn="1"===e.content}if(!this.msgId){const e=this.readLineContent(t);if(!e.canNext)return;this.msgId=e.content}if("undefined"==typeof this.mod){const e=this.readLineContent(t);if(!e.canNext)return;this.mod=e.content}if("0"===this.mod){const e=this.readLineContent(t);if(!e.canNext)return;const n=new i.SocketContext(this.cmd,this.needReturn,this.msgId,this.mod,e.content);return this.clearDataFlag(),n}if(e===c){const e=new i.SocketContext(this.cmd,this.needReturn,this.msgId,this.mod,this.data||"");return this.data=undefined,this.clearDataFlag(),e}""!==t[0]&&(this.data?(this.data+=e,this.tmpMsg=""):this.data=e)}clearDataFlag(){this.cmd=undefined,this.msgId=undefined,this.mod=undefined,this.isFirst=!0,this.needReturn=undefined,this.tmpMsg=""}readLineContent(e){const t=e[0];if(0===t.length)return{content:undefined,canNext:!1};const n=t.indexOf(this.newLine);if(n<0)return this.tmpMsg+=e,{content:undefined,canNext:!1};const r=t.substring(0,n);return e[0]=t.substring(n+1),{content:r,canNext:!0}}}return g.SocketMsgHandler=f,g}var En,Tn,Fn,xn={},kn={};function In(){if(En)return kn;En=1,Object.defineProperty(kn,"__esModule",{value:!0}),kn.SocketFieldInfo=void 0;const e=u,t=Nn();return kn.SocketFieldInfo=class{constructor(t,n,i,o,s,a,c){this._index=0,this._name=t,this._fieldType=n,this._startPos=i,this._endPos=o,this._children=c,this._isFile=s,this._length=o-i;try{if(this._isFile){this._fd=a;const e=r||window&&window.require;this._fs=e("fs");const{Buffer:t}=e("buffer");this._Buffer=t}else this._data=a}catch(u){this._err=new e.SocketDataError("转换字段流失败 => "+u.message)}}get err(){return this._err}get name(){return this._name}get length(){return this._length}get children(){return this._children}read(e){if(this._err)return"";const t=this._index;return this._index+=e,this._index>this._length&&(this._index+=this._length-this._index),this._read(t,this._index)}readByPos(e,t){return this._err?"":this._read(e,t)}readAll(){return this._err?"":this._read(0,this._length)}read2Object(){return this._err?undefined:t.unmarshal(this.readAll())}_read(t,n){if(this._err)return"";n>this._length&&(n=this._length);const r=n-t;if(r<=0)return"";try{if(this._isFile){const e=Buffer.alloc(r);return this._fs.readSync(this._fd,e,0,r,this._startPos),e.toString("utf-8")}return this._data.substring(t,n)}catch(i){return this._err=new e.SocketDataError("获取流中内容失败"),""}}},kn}function On(){if(Tn)return xn;Tn=1,Object.defineProperty(xn,"__esModule",{value:!0}),xn.unmarshalFieldInfo=xn.unmarshalFieldInfoByFile=xn.unmarshalErrByFile=xn.unmarshalErr=xn.dataIsVoid=xn.dataIsError=xn.unmarshalByFilePath=xn.unmarshal=void 0;const e=l,t=u,n=In(),r=_n();function i(n,r){switch(n){case t.FieldType.LIST:let n=[];const o=parseInt(r.lineContent()),s=e.getFieldTypeByFieldTypeStr(r.lineContent());for(let e=0;e<o;e++){if(s===t.FieldType.LIST||s===t.FieldType.STRUCT){n.push(i(s,r));continue}if(s===t.FieldType.STRING){const e=parseInt(r.lineContent());n.push(r.lineLenContent(e));continue}const e=r.lineContent();let o;if(s===t.FieldType.DOUBLE)o=parseFloat(e);else if(s===t.FieldType.INTEGER)o=parseInt(e);else{if(s!==t.FieldType.BOOL)throw new t.SocketDataError("错误的数据类型 => "+s);o="0"!==e}n.push(o)}return n;case t.FieldType.STRING:const a=parseInt(r.lineContent());return r.lineLenContent(a);case t.FieldType.DOUBLE:return parseFloat(r.lineContent());case t.FieldType.BOOL:return"0"!==r.lineContent();case t.FieldType.INTEGER:return parseInt(r.lineContent())}return function(n,r){if(n===t.FieldType.LIST)return i(n,r);if(n!==t.FieldType.STRUCT)throw new t.SocketDataError("不支持非Obj或Array的顶层结构");const o=parseInt(r.lineContent());let s={};for(let n=0;n<o;n++){const o=r.lineContent();if(""==o){n-=1;continue}const a=e.getFieldTypeByFieldTypeStr(r.lineContent());if(a===t.FieldType.LIST||a===t.FieldType.STRUCT){s[o]=i(a,r);continue}if(a===t.FieldType.STRING){const e=parseInt(r.lineContent());s[o]=r.lineLenContent(e);continue}const c=r.lineContent();let u;if(a===t.FieldType.DOUBLE)u=parseFloat(c);else if(a===t.FieldType.INTEGER)u=parseInt(c);else{if(a!==t.FieldType.BOOL)throw new t.SocketDataError("错误的数据类型 => "+a);u="0"!==c}s[o]=u}return s}(n,r)}function o(n){return e.getFieldTypeByFieldTypeStr(n)===t.FieldType.ERROR}function s(n,r,i){const o=i.nowIndex();let a=!1;switch(n){case t.FieldType.LIST:const n=parseInt(i.lineContent());if(0==n)return;const o=e.getFieldTypeByFieldTypeStr(i.lineContent());for(let e=0;e<n;e++){const n=i.nowIndex();if(o!==t.FieldType.LIST&&o!==t.FieldType.STRUCT){if(o===t.FieldType.STRING){const e=parseInt(i.lineContent());i.breakLen(e)}else i.lineContent();r[e+""]=i.createFieldInfo(e+"",o,n)}else{const t={};s(o,t,i),r[e+""]=i.createFieldInfo(e+"",o,n,t)}}return;case t.FieldType.STRING:const c=parseInt(i.lineContent());i.breakLen(c),a=!0;break;case t.FieldType.BOOL:case t.FieldType.DOUBLE:case t.FieldType.INTEGER:i.lineContent(),a=!0}a?r[0]=i.createFieldInfo("0",n,o):function(n,r,i){if(n===t.FieldType.LIST)return void s(n,r,i);if(n!==t.FieldType.STRUCT)throw new t.SocketDataError("不支持非Obj或Array的顶层结构");const o=parseInt(i.lineContent());for(let n=0;n<o;n++){const n=i.nowIndex(),o=i.lineContent(),a=e.getFieldTypeByFieldTypeStr(i.lineContent());if(a!==t.FieldType.LIST&&a!==t.FieldType.STRUCT){if(a===t.FieldType.STRING){const e=parseInt(i.lineContent());i.breakLen(e)}else i.lineContent();r[o]=i.createFieldInfo(o,a,n)}else{const e={};s(a,e,i),r[o]=i.createFieldInfo(o,a,n,e)}}}(n,r,i)}return xn.unmarshal=function(t){const n=[t],r=e.getLineContent(n);return i(e.getFieldTypeByFieldTypeStr(r),{lineContent:()=>e.getLineContent(n),lineLenContent:e=>{const t=Array.from(n[0]),r=t.splice(0,e).join("");return n[0]=t.join(""),r}})},xn.unmarshalByFilePath=function(n){if(!r.WebsocketClient.requireFn)throw new t.SocketDataError("未在本地环境中运行");const o=r.WebsocketClient.requireFn("fs"),s=o.openSync(n,"r"),{Buffer:a}=r.WebsocketClient.requireFn("buffer");try{return i(e.getFieldTypeByFieldTypeStr(e.getLineContentByFile(o,s,a)),{lineContent:()=>e.getLineContentByFile(o,s,a),lineLenContent:e=>{const t=a.alloc(e);return o.readSync(s,t,0,e,null),t.toString("utf-8")}})}finally{o.close(s)}},xn.dataIsError=o,xn.dataIsVoid=function(n){return e.getFieldTypeByFieldTypeStr(n)===t.FieldType.VOID},xn.unmarshalErr=function(n){const r=[n];if(!o(e.getLineContent(r)))throw new t.SocketDataError("错误的字段类型");const i=e.getLineContent(r),s=parseInt(e.getLineContent(r));return{code:i,msg:r[0].substring(0,s)}},xn.unmarshalErrByFile=function(n,r,i){if(!o(e.getLineContentByFile(n,r,i)))throw new t.SocketDataError("错误的字段类型");const s=e.getLineContentByFile(n,r,i),a=parseInt(e.getLineContentByFile(n,r,i)),c=i.alloc(a);return n.readSync(r,c,0,a,null),{code:s,msg:c.toString("utf-8")}},xn.unmarshalFieldInfoByFile=function(t,r,i){const o=e.getLineContentByFile(t,r,i),a=[];a[0]=o.length+1;const c={};return s(e.getFieldTypeByFieldTypeStr(o),c,{lineContent:()=>{const n=e.getLineContentByFile(t,r,i);return a[0]+=n.length+1,n},lineLenContent:e=>{a[0]+=e;const n=i.alloc(e);return t.readSync(r,n,0,e,null),n.toString("utf-8")},breakLen:e=>{const n=131072;let o=0;for(;o<e;){let s=n;o+n>e&&(s=e-o);const a=i.alloc(s);o+=t.readSync(r,a,0,s,null)}a[0]+=e},nowIndex:()=>a[0],createFieldInfo:(e,t,i,o)=>new n.SocketFieldInfo(e,t,i,a[0],!0,r,o)}),c},xn.unmarshalFieldInfo=function(t){const r=[t],i=e.getLineContent(r),o=[];o[0]=i.length+1;const a={};return s(e.getFieldTypeByFieldTypeStr(i),a,{lineContent:()=>{const t=e.getLineContent(r);return o[0]+=t.length+1,t},lineLenContent:e=>{const t=Array.from(r[0]),n=t.slice(0,e).join("");return r[0]=t.join(""),o[0]+=e,n},breakLen:e=>{o[0]+=e,r[0]=r[0].substring(e)},nowIndex:()=>o[0],createFieldInfo:(e,r,i,s)=>new n.SocketFieldInfo(e,r,i,o[0],!1,t,s)}),a},xn}function Nn(){return Fn||(Fn=1,function(e){var t=n&&n.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),r=n&&n.__exportStar||function(e,n){for(var r in e)"default"===r||n.hasOwnProperty(r)||t(n,e,r)};Object.defineProperty(e,"__esModule",{value:!0}),r(function(){if(wn)return c;wn=1,Object.defineProperty(c,"__esModule",{value:!0}),c.marshal=c.marshal2FilePath=c.marshalErr2FilePath=c.marshalErr=c.marshalVoid=c.marshalVoid2FilePath=void 0;const e=u,t=l,n=_n();function r(){if(!n.WebsocketClient.requireFn)throw new e.SocketDataError("未在本地环境中运行");const t=n.WebsocketClient.requireFn("fs"),r=n.WebsocketClient.requireFn("os"),i=n.WebsocketClient.requireFn("path"),o=i.join(r.tmpdir(),"devPlatform_w");t.mkdirSync(o,{recursive:!0});const s=i.join(o,`${Math.random()}-${(new Date).getTime()}`),a=t.openSync(s,"w");return{fs:t,fd:a,filePath:s}}function i(n,r,i){const s=t.getFieldType(i);if(s===e.FieldType.STRING||s===e.FieldType.BOOL||s===e.FieldType.DOUBLE||s===e.FieldType.INTEGER)return n.writeSync(r,t.joinLineStr(s)),s===e.FieldType.STRING?(n.writeSync(r,t.joinLineStr(Array.from(i).length)),void n.writeSync(r,i)):s===e.FieldType.BOOL?void n.writeSync(r,t.joinLineStr(i?"1":"0")):void n.writeSync(r,t.joinLineStr(i));if(i instanceof Array){if(n.writeSync(r,t.joinLineStr(e.FieldType.LIST)),n.writeSync(r,t.joinLineStr(i.length)),0===i.length)return;const s=t.getListEleFieldType(i);if(!s)throw new e.SocketDataError("获取数组内元素类型失败");if(n.writeSync(r,t.joinLineStr(s)),s===e.FieldType.STRUCT||s===e.FieldType.LIST)for(let e of i)o(n,r,e,!1);else for(let o of i)s!==e.FieldType.STRING?(s===e.FieldType.BOOL&&n.writeSync(r,t.joinLineStr(o?"1":"0")),n.writeSync(r,t.joinLineStr(o))):n.writeSync(r,t.joinLineStr(Array.from(o).length)+o)}else o(n,r,i,!0)}function o(n,r,o,s){if(o instanceof Array)return i(n,r,o);if("object"!=typeof o)throw new e.SocketDataError("不支持非Obj或Array的顶层结构");const a=t.ObjectKeys(o).length;if(s&&n.writeSync(r,t.joinLineStr(e.FieldType.STRUCT)),n.writeSync(r,t.joinLineStr(a)),0!==a)for(let s in o){const a=o[s];n.writeSync(r,t.joinLineStr(s));const c=t.getFieldType(a);c!==e.FieldType.LIST&&c!==e.FieldType.STRUCT?(n.writeSync(r,t.joinLineStr(c)),c!==e.FieldType.STRING?c!==e.FieldType.BOOL?n.writeSync(r,t.joinLineStr(a)):n.writeSync(r,t.joinLineStr(a?"1":"0")):(n.writeSync(r,t.joinLineStr(Array.from(a).length)),n.writeSync(r,a+""))):i(n,r,a)}}function s(n){const r=t.getFieldType(n);if(r===e.FieldType.STRING||r===e.FieldType.BOOL||r===e.FieldType.DOUBLE||r===e.FieldType.INTEGER){let i=t.joinLineStr(r);return r===e.FieldType.STRING?(i+=t.joinLineStr(Array.from(n).length),i+=n,i):r===e.FieldType.BOOL?(i+=t.joinLineStr(n?"1":"0"),i):(i+=t.joinLineStr(n),i)}if(n instanceof Array){let r=t.joinLineStr(e.FieldType.LIST)+t.joinLineStr(n.length);if(0===n.length)return r;const i=t.getListEleFieldType(n);if(!i)throw new e.SocketDataError("获取数组内元素类型失败");if(r+=t.joinLineStr(i),i===e.FieldType.STRUCT||i===e.FieldType.LIST)for(let e of n)r+=a(e,!1);else for(let o of n)i!==e.FieldType.STRING?i!==e.FieldType.BOOL?r+=t.joinLineStr(o):r+=t.joinLineStr(o?"1":"0"):r+=t.joinLineStr(Array.from(o).length)+o;return r}return a(n,!0)}function a(n,r){if(n instanceof Array)return s(n);if("object"!=typeof n)throw new e.SocketDataError("不支持非Obj或Array的顶层结构");const i=t.ObjectKeys(n).length;let o="";r&&(o=t.joinLineStr(e.FieldType.STRUCT)),o+=t.joinLineStr(i);for(let r in n){const i=n[r];o+=t.joinLineStr(r);const a=t.getFieldType(i);a!==e.FieldType.LIST&&a!==e.FieldType.STRUCT?(o+=t.joinLineStr(a),a!==e.FieldType.STRING?a!==e.FieldType.BOOL?o+=t.joinLineStr(i):o+=t.joinLineStr(i?"1":"0"):o+=t.joinLineStr(Array.from(i).length)+i):o+=s(i)}return o}return c.marshalVoid2FilePath=function(){const{fs:n,fd:i,filePath:o}=r();try{n.writeSync(i,t.joinLineStr(e.FieldType.VOID))}catch(s){throw n.unlinkSync(o),s}finally{n.closeSync(i)}return o},c.marshalVoid=function(){return t.joinLineStr(e.FieldType.VOID)},c.marshalErr=function(n,r){return t.joinLineStr(e.FieldType.ERROR)+t.joinLineStr(n)+t.joinLineStr(Array.from(r).length)+r},c.marshalErr2FilePath=function(n,i){const{fs:o,fd:s,filePath:a}=r();try{o.writeSync(s,t.joinLineStr(e.FieldType.ERROR)+t.joinLineStr(n)+t.joinLineStr(Array.from(i).length)+i)}catch(c){throw o.unlinkSync(a),c}finally{o.closeSync(s)}return a},c.marshal2FilePath=function(e){const{fs:t,fd:n,filePath:o}=r();try{i(t,n,e)}catch(s){throw t.unlinkSync(o),s}finally{t.closeSync(n)}return o},c.marshal=s,c}(),e),r(On(),e)}(a)),a}!function(e){var t=n&&n.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),r=n&&n.__exportStar||function(e,n){for(var r in e)"default"===r||n.hasOwnProperty(r)||t(n,e,r)};Object.defineProperty(e,"__esModule",{value:!0}),r(Nn(),e),r(gn(),e),r(In(),e),r(_n(),e)}(s);var jn={};Object.defineProperty(jn,"__esModule",{value:!0}),jn.GetLogInterface=jn.EnabledLog=void 0;let Mn={log:(e,...t)=>{}};jn.EnabledLog=()=>!0,jn.GetLogInterface=()=>Mn,function(e){var t=n&&n.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),r=n&&n.__exportStar||function(e,n){for(var r in e)"default"===r||n.hasOwnProperty(r)||t(n,e,r)};Object.defineProperty(e,"__esModule",{value:!0}),r(s,e),r(Nn(),e),r(jn,e)}(o);var Rn={},Ln={};Object.defineProperty(Ln,"__esModule",{value:!0}),Ln.eSignSplitDetailItems=Ln.eSealSplitFiveData=Ln.eSealSplitDetailItems=Ln.eSealSplitFourData=Ln.getKeyCert=Ln.p7Sign=Ln.createClientAuthProof=Ln.createClientAuthRequest=Ln.getKeyCertType=Ln.setCertEquipFilter=Ln.getESealData=Ln.writeESealData=Ln.importElecSymmKey=Ln.formatKey=Ln.importCert=Ln.createKeyPair=Ln.awaitAuthData=Ln.getKeyNum=Ln.filterKey=Ln.releaseKey=Ln.initKey=Ln.Open=void 0,Ln.Open="open",Ln.initKey="init/key",Ln.releaseKey="",Ln.filterKey="",Ln.getKeyNum="",Ln.awaitAuthData="",Ln.createKeyPair="",Ln.importCert="",Ln.formatKey="",Ln.importElecSymmKey="",Ln.writeESealData="",Ln.getESealData="",Ln.setCertEquipFilter="",Ln.getKeyCertType="",Ln.createClientAuthRequest="",Ln.createClientAuthProof="",Ln.p7Sign="",Ln.getKeyCert="",Ln.eSealSplitFourData="",Ln.eSealSplitDetailItems="",Ln.eSealSplitFiveData="",Ln.eSignSplitDetailItems="";var Pn=n&&n.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),An=n&&n.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t}),Dn=n&&n.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&Pn(t,e,n);return An(t,e),t};Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.SocketCmd=Dn(Ln);var Bn={},qn={};Object.defineProperty(qn,"__esModule",{value:!0}),qn.eSignSplitDetailItems=qn.eSealSplitFiveData=qn.eSealSplitDetailItems=qn.eSealSplitFourData=qn.getKeyCert=qn.p7Sign=qn.createClientAuthProof=qn.createClientAuthRequest=qn.getKeyCertType=qn.setCertEquipFilter=qn.getESealData=qn.writeESealData=qn.importElecSymmKey=qn.formatKey=qn.importCert=qn.createKeyPair=qn.awaitAuthData=qn.getKeyNum=qn.filterKey=qn.releaseKey=qn.initKey=void 0;const Un=Rn,Kn=o;qn.initKey=async function(e,t,n){const r=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{authCode:e,dllList:t,devAuthItems:n}});try{const e=await Kn.WebsocketClient.getConn().sendMsg(r);if(e.err)throw e.err}finally{await r.destroy()}},qn.releaseKey=async function(){const e=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.releaseKey,{needReturn:!0,data:{}});try{throw(await Kn.WebsocketClient.getConn().sendMsg(e)).err}finally{await e.destroy()}},qn.filterKey=async function(e,t){const n=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{flag:e,filterValue:t}});try{await Kn.WebsocketClient.getConn().sendMsg(n)}catch(r){}finally{await n.destroy()}},qn.getKeyNum=async function(){const e=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{}});try{await Kn.WebsocketClient.getConn().sendMsg(e)}catch(t){}finally{await e.destroy()}},qn.awaitAuthData=async function(e){const t=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{param:e}});try{await Kn.WebsocketClient.getConn().sendMsg(t)}catch(n){}finally{await t.destroy()}},qn.createKeyPair=async function(e,t){const n=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{password:e,strAppDevAuthEnvData:t}});try{await Kn.WebsocketClient.getConn().sendMsg(n)}catch(r){}finally{await n.destroy()}},qn.importCert=async function(e){const t=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{param:e}});try{await Kn.WebsocketClient.getConn().sendMsg(t)}catch(n){}finally{await t.destroy()}},qn.formatKey=async function(e){const t=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{enSoPin:e}});try{await Kn.WebsocketClient.getConn().sendMsg(t)}catch(n){}finally{await t.destroy()}},qn.importElecSymmKey=async function(e,t,n){const r=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{SymmAMKEncData:e,SymmEDKEncData:t,password:n}});try{await Kn.WebsocketClient.getConn().sendMsg(r)}catch(i){}finally{await r.destroy()}},qn.writeESealData=async function(e,t){const n=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{ESealData:e,password:t}});try{throw(await Kn.WebsocketClient.getConn().sendMsg(n)).err}finally{await n.destroy()}},qn.getESealData=async function(e,t,n){const r=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{password:e,KeyIndex:t,KeyAlgId:n}});try{await Kn.WebsocketClient.getConn().sendMsg(r)}catch(i){}finally{await r.destroy()}},qn.setCertEquipFilter=async function(e={}){const t=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{options:e}});try{await Kn.WebsocketClient.getConn().sendMsg(t)}catch(n){}finally{await t.destroy()}},qn.getKeyCertType=async function(e,t,n={}){const r=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{flag:e,filterValue:t,options:n}});try{await Kn.WebsocketClient.getConn().sendMsg(r)}catch(i){}finally{await r.destroy()}},qn.createClientAuthRequest=async function(e,t={}){const n=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{param:e,options:t}});try{await Kn.WebsocketClient.getConn().sendMsg(n)}catch(r){}finally{await n.destroy()}},qn.createClientAuthProof=async function(e,t={}){const n=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{param:e,options:t}});try{await Kn.WebsocketClient.getConn().sendMsg(n)}catch(r){}finally{await n.destroy()}},qn.p7Sign=async function(e,t={}){const n=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{param:e,options:t}});try{await Kn.WebsocketClient.getConn().sendMsg(n)}catch(r){}finally{await n.destroy()}},qn.getKeyCert=async function(e,t,n={}){const r=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{keyType:e,dwCertNum:t,options:n}});try{await Kn.WebsocketClient.getConn().sendMsg(r)}catch(i){}finally{await r.destroy()}},qn.eSealSplitFourData=async function(e,t,n={}){const r=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{flag:e,dzyz:t,options:n}});try{await Kn.WebsocketClient.getConn().sendMsg(r)}catch(i){}finally{await r.destroy()}},qn.eSealSplitDetailItems=async function(e,t,n={}){const r=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{flag:e,dzyz:t,options:n}});try{await Kn.WebsocketClient.getConn().sendMsg(r)}catch(i){}finally{await r.destroy()}},qn.eSealSplitFiveData=async function(e,t,n={}){const r=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{flag:e,dzyz:t,options:n}});try{await Kn.WebsocketClient.getConn().sendMsg(r)}catch(i){}finally{await r.destroy()}},qn.eSignSplitDetailItems=async function(e,t,n={}){const r=Kn.SocketContext.createSendMsgContext(Un.SocketCmd.initKey,{needReturn:!0,data:{flag:e,dzyz:t,options:n}});try{await Kn.WebsocketClient.getConn().sendMsg(r)}catch(i){}finally{await r.destroy()}},function(e){var t=n&&n.__createBinding||(Object.create?function(e,t,n,r){r===undefined&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){r===undefined&&(r=n),e[r]=t[n]}),r=n&&n.__exportStar||function(e,n){for(var r in e)"default"===r||n.hasOwnProperty(r)||t(n,e,r)};Object.defineProperty(e,"__esModule",{value:!0}),r(qn,e)}(Bn),Object.defineProperty(i,"__esModule",{value:!0}),i.usbKey=i.EndAndClose=Hn=i.Begin=void 0;const Wn=o,Vn=Rn,Gn=Bn;class zn{constructor(){this.userAgent="undefined"!=typeof window?window.navigator.userAgent:"server-client",this.appName="UsbKey默认应用",this.isBegin=!1,this.canUse=!1,this.connListener=undefined,this.open=async e=>{const t=await e.returnObj({appName:this.appName,userAgent:this.userAgent},{needReturn:!0});t.isVoid?(this.openResolve&&this.openResolve(),this.connListener&&this.connListener("open")):this.openError&&this.openError(t.err)},this.InitKey=this.sockjsPromiseFnConvert(Gn.initKey),this.ReleaseKey=this.sockjsPromiseFnConvert(Gn.releaseKey),this.FilterKey=this.sockjsPromiseFnConvert(Gn.filterKey),this.GetKeyNum=this.sockjsPromiseFnConvert(Gn.getKeyNum),this.AwaitAuthData=this.sockjsPromiseFnConvert(Gn.awaitAuthData),this.CreateKeyPair=this.sockjsPromiseFnConvert(Gn.createKeyPair),this.ImportCert=this.sockjsPromiseFnConvert(Gn.importCert),this.FormatKey=this.sockjsPromiseFnConvert(Gn.formatKey),this.ImportElecSymmKey=this.sockjsPromiseFnConvert(Gn.importElecSymmKey),this.WriteESealData=this.sockjsPromiseFnConvert(Gn.writeESealData),this.GetESealData=this.sockjsPromiseFnConvert(Gn.getESealData),this.SetCertEquipFilter=this.sockjsPromiseFnConvert(Gn.setCertEquipFilter),this.GetKeyCertType=this.sockjsPromiseFnConvert(Gn.getKeyCertType),this.CreateClientAuthRequest=this.sockjsPromiseFnConvert(Gn.createClientAuthRequest),this.CreateClientAuthProof=this.sockjsPromiseFnConvert(Gn.createClientAuthProof),this.P7Sign=this.sockjsPromiseFnConvert(Gn.p7Sign),this.GetKeyCert=this.sockjsPromiseFnConvert(Gn.getKeyCert),this.ESealSplitFourData=this.sockjsPromiseFnConvert(Gn.eSealSplitFourData),this.ESealSplitDetailItems=this.sockjsPromiseFnConvert(Gn.eSealSplitDetailItems),this.ESealSplitFiveData=this.sockjsPromiseFnConvert(Gn.eSealSplitFiveData),this.ESignSplitDetailItems=this.sockjsPromiseFnConvert(Gn.eSignSplitDetailItems),this.init()}static Current(){return zn.INSTANCE}init(){Wn.WebsocketClient.registryWebsocketHook("close",(e=>{this.canUse=!1,this.isBegin&&(this.connListener&&this.connListener("close"),this.reconnectionTimeOutId&&(clearTimeout(this.reconnectionTimeOutId),this.reconnectionTimeOutId=undefined),this.reconnectionTimeOutId=setTimeout((()=>{e.reconnection()}),3e3))})),Wn.WebsocketClient.registryWebsocketHook("open",(async e=>{this.canUse=!0})),Wn.WebsocketClient.registryEventHandle(Vn.SocketCmd.Open,this.open)}begin(e){return new Promise(((t,n)=>{if((zn.INSTANCE.initParam||e.url===zn.INSTANCE.initParam)&&(e.connectionListener&&(zn.INSTANCE.connListener=e.connectionListener),!e.url))return zn.INSTANCE.initParam=e,void t();zn.INSTANCE.initParam=e,zn.INSTANCE.conn&&this.endAndClose();const i={url:e.url,maxMsgBlockSize:e.maxMsgBlockSize,timeout:e.timeout};e.disableAutoRequireFn?i.requireFn=e.requireFn:"undefined"!=typeof window&&window.require?i.requireFn=window.require:i.requireFn=r,e.appName&&(this.appName=e.appName),e.timeout||(e.timeout=3e4),zn.INSTANCE.isBegin=!0,zn.INSTANCE.openResolve=t,zn.INSTANCE.openError=n,e.connectionListener&&(zn.INSTANCE.connListener=e.connectionListener),Wn.WebsocketClient.init(i)}))}endAndClose(){this.initParam=undefined,this.isBegin=!1,this.canUse=!1,this.reconnectionTimeOutId&&(clearTimeout(this.reconnectionTimeOutId),this.reconnectionTimeOutId=undefined),this.conn&&(this.conn.closeConnection(),this.conn=undefined)}sockjsPromiseFnConvert(e){return(...t)=>this.isBegin?this.canUse?e(...t,this.initParam):Promise.reject("网络不可用"):Promise.reject("还没开始工作")}}zn.INSTANCE=new zn;var Hn=i.Begin=zn.Current().begin;i.EndAndClose=zn.Current().endAndClose,i.usbKey=zn.Current();var Jn={retry:!1,retryCount:1,retryInterval:1e3,timeout:-1};const Xn=()=>Jn,$n={timeout:"请求超时",networkError:"网络错误"},Yn=e=>null===e||e===undefined||""===e,Qn=e=>Yn(e)||e.length<=0,Zn=()=>{for(var e="",t=1;t<=32;t++){e+=Math.floor(16*Math.random()).toString(16),8!==t&&12!==t&&16!==t&&20!==t||(e+="")}return e},er=e=>!Yn(e)&&"[object Object]"===e.toString();function tr(e){return 72*(e/25.4)}var nr=!1;const rr=async(e,t,n)=>{try{var r=await(async e=>new Promise(((t,n)=>{var r=new XMLHttpRequest;r.open("POST",e.url),r.onreadystatechange=()=>{if(4===r.readyState)if(200===r.status){if(Yn(r.responseText))return void n("后台返回空响应");let i;try{i=JSON.parse(r.responseText)}catch(e){return void n("解析响应结果失败")}const{code:o,msg:s}=i;if("0"!==o)return void n(s);t(!0)}else n($n.networkError)},r.send(e.data)})))(e);return Promise.resolve(r)}catch(i){if((Yn(i)?"":i.toString())!=$n.networkError)return Promise.reject(i)}return!t.retry||n>=t.retryCount?Promise.reject($n.networkError):new Promise(((r,o)=>{setTimeout((async()=>{try{var s=await rr(e,t,n++);r(s)}catch(i){o(i)}}),t.retryInterval)}))},ir=async(e,t)=>{const n=t??Xn();return new Promise((async(t,r)=>{n.timeout&&n.timeout>0&&setTimeout((()=>{r($n.timeout)}),n.timeout);try{t(await or(e,n,1))}catch(o){var i=(Yn(o)?"":o.toString()).replace("socketContextError: ","");r(i)}}))},or=async(e,t,n)=>{if(nr)try{var r=await(async e=>{try{var t={mod:"1",needReturn:!0,data:Yn(e.data)?undefined:er(e.data)?JSON.stringify(e.data):e.data};const r=o.SocketContext.createSendMsgContext(e.cmd,t);if(r.err)return e.onError?.(r.err),Promise.reject(r.err);const i=await o.WebsocketClient.getConn().sendMsg(r);if(i.err)return e.onError?.(i.err),Promise.reject(i.err);if(i.isVoid)return Promise.resolve();let s=i.unmarshal();if("string"==typeof s)try{s=JSON.parse(s)}catch(n){}finally{return Promise.resolve(s)}}catch(r){return e.onError?.(r),Promise.reject(r)}finally{e["finally"]?.()}})(e);return Promise.resolve(r)}catch(s){var i=Yn(s)?"":s.toString();if(!(!nr||i.indexOf("网络错误")>=0||i.indexOf("未与服务器建立连接")>=0))return Promise.reject(s)}return!t.retry||n>=t.retryCount?Promise.reject($n.networkError):new Promise(((r,i)=>{setTimeout((async()=>{try{var o=await or(e,t,n++);r(o)}catch(s){i(s)}}),t.retryInterval)}))},sr=async(e,t)=>{var n="https://127.0.0.1:28006/bigFileUpload";e.url&&(n=e.url);var r=new FormData;return r.append("fileId",e.fileId),r.append("index",e.index),r.append("sliceId",e.sliceId),r.append("buffer",new Blob([e.buffer])),(async(e,t)=>{const n=t??Xn();return new Promise((async(t,r)=>{n.timeout&&n.timeout>0&&setTimeout((()=>{r($n.timeout)}),n.timeout);try{t(await rr(e,n,1))}catch(i){r(i)}}))})({url:n,data:r},t)};var ar=[];const cr=async(e,t)=>{let n=await(async(e,t)=>ir({cmd:"/seal/verify",data:e},t))(e,t);return Qn(n)||n.forEach((e=>{Yn(e.verifyResult)&&(e.verifyResult=!1)})),!Yn(n)&&n.length>0&&(ar=ar.filter((t=>t.fileId!==e))).push({fileId:e,rsp:n}),n},ur=async(e,t)=>{Yn(e)||(Yn(e.positionX)||(e.positionX=tr(e.positionX)),Yn(e.positionY)||(e.positionY=tr(e.positionY)));const n=await(async(e,t)=>ir({cmd:"/seal/sign",data:{id:e.sealId,fileId:e.fileId,pageNum:e.page,x:e.positionX,y:e.positionY,keyPwd:e.pwd}},t))(e,t);return n},lr=async(e,t)=>{!Yn(e)&&!Yn(e.pages)&&e.pages.length>0&&e.pages.forEach((e=>{Yn(e.positionX)||(e.positionX=tr(e.positionX)),Yn(e.positionY)||(e.positionY=tr(e.positionY))}));const n=await(async(e,t)=>ir({cmd:"/seal/signSiteBatch",data:{id:e.sealId,fileId:e.fileId,keyPwd:e.pwd,pageList:e.pages.map((e=>({pageNum:e.page,x:e.positionX,y:e.positionY})))}},t))(e,t);return n};Hn({url:"https://127.0.0.1:28006/dev",connectionListener:e=>{nr="open"===e},disableAutoRequireFn:!0});const dr={connectGet:Xn,connectSet:e=>{Jn=e}},fr={requestError:$n};exports.configMgr=dr,exports.enums=fr,exports.fileClose=async(e,t)=>{try{await(async(e,t)=>ir({cmd:"/seal/removeFile",data:e},t))(e,t);return Promise.resolve(!0)}catch(n){return Promise.reject(n)}},exports.fileDownloadUrlGet=e=>`https://127.0.0.1:28006/download/sealFile?fileId=${e}`,exports.fileOpen=async(e,n)=>new Promise((async(r,i)=>{var o=n??Xn();const s=o.timeout;s&&s>0&&setTimeout((()=>{i($n.timeout)}),s);const{name:a,rawHtmlEle:c,path:u}=e;if(Yn(c)){if(Yn(u))return i("rawHtmlEle参数和path参数不能同时为空")}else if(Yn(c.files)||c.files.length<=0)return i("未在rawHtmlEle中检测到文件");const l=Zn();if(Yn(c)&&!Yn(u)){try{await(async(e,t,n)=>ir({cmd:"/parserAddrUpload",data:{fileId:e,addr:t}},n))(l,u,{...o,timeout:-1})}catch(m){return i(m)}return r(l)}let d;try{d=await((e,n)=>new Promise(((r,i)=>{if(Yn(e))return void i("获取文件失败, 文件不能为空");const o=e.size,s=Math.ceil(o/n);var a=new FileReader;a.onload=e=>{const i=e.target.result;var a=new t["default"].ArrayBuffer,c=[];for(let e=0;e<s;e++){var u=e*n,l=Math.min(o,u+n),d=i.slice(u,l);a.append(d),c.push({index:e,sliceId:Zn(),buffer:d})}var f={md5:a.end(),fileSize:o,array:c};a.destroy(),r(f)},a.readAsArrayBuffer(e)})))(c.files[0],5242880)}catch(m){return i(m)}if(Yn(d)||Yn(d.md5)||Qn(d.array))return i("分片异常");const{md5:f,array:h,fileSize:p}=d;try{await(async(e,t)=>ir({cmd:"/startBigFileUpload",data:e},t))({name:a,id:l,md5:f,sliceNumber:h.length.toString(),size:p.toString()},{...o,timeout:-1})}catch(m){return i(m)}for(let t=0;t<h.length;t++){const n=h[t];try{await sr({url:e.slicingPath,fileId:l,index:n.index.toString(),sliceId:n.sliceId.toString(),buffer:n.buffer},{...o,timeout:-1})}catch(m){return i(m)}}try{await(async(e,t)=>ir({cmd:"/getBigFileUploadResult",data:e},t))(l,{...o,timeout:-1})}catch(m){return i(m)}return r(l)})),exports.sealList=async(e,t)=>{const n=await(async(e,t)=>ir({cmd:"/sealMgr/getSealListByKeyNo",data:e},t))(e,t);return n},exports.sealVerifyAll=cr,exports.sealVerifyOne=async(e,t,n)=>{var r=ar.find((t=>t.fileId===e));if(!Yn(r)&&r.rsp.length>0)return Promise.resolve(r.rsp.find((e=>e.signatureInfo.signatureName===t)));try{var i=await cr(e,n);return!Yn(i)&&i.length>0?i.find((e=>e.signatureInfo.signatureName===t)):Promise.reject("未查询到对应的签名域")}catch(o){return Promise.reject(o)}},exports.signatureByGap=async(e,t)=>{e?.splitPageNum||(e.splitPageNum=10),Yn(e?.x)||(e.x=tr(e.x)),Yn(e?.y)||(e.y=tr(e.y));const n=await(async(e,t)=>ir({cmd:"/seal/signQF",data:{id:e.sealId,fileId:e.fileId,pageNum:1,x:e.x,y:e.y,size:e.splitPageNum,keyPwd:e.password}},t))(e,t);return n},exports.signatureByKeywords=async(e,t)=>{const n=await(async(e,t)=>ir({cmd:"/seal/signKeyword",data:{id:e.sealId,fileId:e.fileId,keyPwd:e.password,keyword:e.keywords,offset:e.offset,keywordNo:e.hitNo}},t))(e,t);return n},exports.signatureByPosition=async(e,t,n,r,i)=>Yn(n)||n.length<=0?Promise.reject("请传入坐标相关信息"):n.length>1?lr({sealId:t,fileId:e,pwd:r,pages:n.map((e=>({page:e.pageNo,positionX:e.x,positionY:e.y})))},i):ur({sealId:t,fileId:e,page:n[0].pageNo,positionX:n[0].x,positionY:n[0].y,pwd:r},i);
